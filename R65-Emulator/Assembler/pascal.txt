----------------------------------------------------------------------

R65 PASCAL: LABELS                 24/02/19   R65 ASSEMBLER  PAGE 01

0001                   *
0002                   *       **********************
0003                   *       * R65 PASCAL RUNTIME *
0004                   *       **********************
0005                   *
0006                   * VERSION 5.3 01/06/82 RRICHARZ,RBAUMANN
0007                   *
0008                           TIT R65 PASCAL RUNTIME
0009                   *
0010                   * INCLUDES RANDOM ACCESS FILE HANDLING,
0011                   * FLOATING POINT MATH, FILE HANDLING ERROR
0012                   * TESTING (OPTIONAL)
0013                   *
0014                           ORG 0
0015                   *
0016  0000-            ACCU    BSS 4   TOP OF STACKELEMENT
0017                   X1      EQU ACCU        FLP ACCU
0018                   M1      EQU ACCU+1
0019  0004-            E       BSS 4   FLP SCRATCH REGISTER
0020  0008-            SP      BSS 2   CURRENT STACK (-128)
0021  000A-            PC      BSS 2   PROGRAM COUNTER
0022  000C-            RUNERR  BSS 1   RUNTIME ERROR CODE
0023  000D-            DEVICE  BSS 1   I/O DEVICE CODE
0024  000E-            ENDSTK  BSS 2   END OF STACK (-128)
0025  0010-            SIGN    BSS 1   TEMPORARY SIGN
0026  0011-            STPROG  BSS 2   START OF USER PROGRAM
0027  0013-            EOPROG  BSS 2   END OF USER PRORMA
0028  0015-            BUFFPN  BSS 1   INPUT BUFFER POINTER
0029  0016-            ENDBUF  BSS 1   END OF INPUT BUFFER
0030  0017-            BASE    BSS 2   CURRENT BASE (-128)
0031  0019-            ABASE   BSS 2   ALTERNATE BASE (-128)
0032  001B-            ARG1    BSS 2   TEMPORARY ARGUMENT
0033  001D-            ARG3    BSS 4   TEMPORARY REGISTERS
0034  0021-            ARG2    BSS 2
0035                   X2      EQU ARG1        FLP REGISTER
0036                   M2      EQU ARG1+1
0037  0023-            IOCHECK BSS 1   IO ERROR CHECKING FLAG
0038  0024-            LINBUF  BSS 56  INPUT LINE BUFFER
0039                   *
0040                   FILFLG  EQU $DA
0041                   FILERR  EQU $DB
0042                   FILDRV  EQU $DC
0043                   TRACK   EQU $DD
0044                   SECTOR  EQU $DE
0045                   DATA    EQU $E0
0046                   VIDPNT  EQU $E9
0047                   POINT   EQU $FA
0048                   KCHAR   EQU $FE
0049                   *
0050                   EMUCOM  EQU $1430       EMULATOR COMMAND REG

----------------------------------------------------------------------

R65 PASCAL RUNTIME                 24/02/19   R65 ASSEMBLER  PAGE 02

0051                   MULTA   EQU $14E0
0052                   MULTB   EQU $14E1
0053                   MULTR   EQU $14E2
0054                   *
0055                   FILTYP  EQU $0300
0056                   FILNAM  EQU $0301
0057                   FILCYC  EQU $0311
0058                   FILSTP  EQU $0312
0059                   FILLOC  EQU $0313
0060                   FILSIZ  EQU $0315
0061                   FILSA   EQU $031A
0062                   FILEA   EQU $031C
0063                   FILNM1  EQU $0320
0064                   FILCY1  EQU $0330
0065                   FILSA1  EQU $0331
0066                   SAVRST  EQU $0333
0067                   CURSEQ  EQU $0335
0068                   MAXSEQ  EQU $0336
0069                   MAXSIZ  EQU $0337
0070                   FIDRTB  EQU $0339
0071                   FIDVTB  EQU $0341
0072                   FIBPTB  EQU $0349
0073                   FIRCTB  EQU $0351
0074                   SFLAG   EQU $1781
0075                   NUMCHR  EQU $178A
0076                   VMON    EQU $17D5
0077                   *
0078                   GETKEY  EQU $E000
0079                   AUTOPR  EQU $E00C
0080                   ENDLIN  EQU $E024
0081                   PRTINF  EQU $E027
0082                   GETCHR  EQU $E003
0083                   GETLIN  EQU $E006
0084                   PRTCHR  EQU $E009
0085                   PRTBYT  EQU $E02D
0086                   PRTAX   EQU $E030
0087                   PRTRSA  EQU $E836
0088                   RDFILE  EQU $E815
0089                   SETFID  EQU $E81E
0090                   OPEN    EQU $F00F
0091                   READCH  EQU $F018
0092                   WRITCH  EQU $F01B
0093                   GETNAM  EQU $F815
0094                   *
0095  005C-                    ORG $2000
0096                   *
0097                           PAG

----------------------------------------------------------------------

R65 PASCAL RUNTIME                 24/02/19   R65 ASSEMBLER  PAGE 03

0098                   *
0099                   * ENTRY VECTORS
0100                   *
0101  2000- 4C A5 2A           JMP COLDST      COLD START ENTRY VECTOR
0102  2003- 4C 1C 29           JMP WARMST      WARM START ENTRY VECTOR
0103  2006- 4C E1 28           JMP PERROR      PASCAL ERROR
0104                   *
0105  2009- 61 2D      USERST  WRD ENDCODE+32
0106  200B- FF C7      USEREND WRD $C7FF
0107                   *
0108  200D- 4C F2 FC   HARGUM  JMP $FCF2       #######
0109                   *
0110                   *
0111                   * P-CODE 00:  STOP      (END OF EXECUTION)
0112                   ******************
0113                   * NO ARGUMENTS
0114                   *
0115  2010- A5 11      STOP    LDA STPROG      IS ANOTHER PROGRAM
0116  2012- A6 12              LDX STPROG+1    RUNNING?
0117  2014- CD 09 20           CMP USERST
0118  2017- D0 22              BNE STOP1
0119  2019- EC 0A 20           CPX USERST+1
0120  201C- D0 1D              BNE STOP1
0121                   *
0122  201E- 20 27 E0           JSR PRTINF      NO, STOP PASCAL
0123  2021- 0D 0A 51           BYT $D,$A,'Quit Pascal',$D,$8A
0123  2024- 75 69 74 
0123  2027- 20 50 61 
0123  202A- 73 63 61 
0123  202D- 6C 0D 8A 
0124  2030- AD 81 17           LDA SFLAG
0125  2033- 29 FE              AND =$FE        CLEAR PASCAL RUNTIME BIT
0126  2035- 8D 81 17           STA SFLAG       IN SFLAG
0127  2038- 6C D5 17           JMP (VMON)
0128                   *
0129  203B- 38         STOP1   SEC             YES, COMPUTE OLD SP
0130  203C- E9 8C              SBC =140
0131  203E- B0 01              BCS *+3
0132  2040- CA                 DEX
0133  2041- 85 08              STA SP
0134  2043- 86 09              STX SP+1
0135  2045- A0 8C              LDY =140
0136  2047- 20 65 27           JSR GETBACK
0137  204A- 85 13              STA EOPROG
0138  204C- 86 14              STX EOPROG+1
0139  204E- 20 65 27           JSR GETBACK
0140  2051- 85 11              STA STPROG
0141  2053- 86 12              STX STPROG+1
0142  2055- 20 65 27           JSR GETBACK
0143  2058- 85 0A              STA PC

----------------------------------------------------------------------

R65 PASCAL RUNTIME                 24/02/19   R65 ASSEMBLER  PAGE 04

0144  205A- 86 0B              STX PC+1
0145  205C- 20 65 27           JSR GETBACK
0146  205F- 85 17              STA BASE
0147  2061- 86 18              STX BASE+1
0148  2063- 20 65 27           JSR GETBACK
0149  2066- 85 00              STA ACCU
0150  2068- 86 01              STX ACCU+1
0151  206A- 4C B8 29           JMP LOOP
0152                   *
0153                   *
0154  206D- 4C FF F0   DOPEN1  JMP $F0FF
0155  2070- 4C 45 F1   DOPEN4  JMP $F145
0156  2073- 4C 51 F1   PRFLB1  JMP $F151
0157  2076- 4C 59 F1   CPOINT  JMP $F159
0158  2079- 4C E0 F1   PREPSR  JMP $F1E0
0159  207C- 4C 9E F2   PREPSR1 JMP $F29E
0160  207F- 4C BF F2   CLOSE   JMP $F2BF
0161  2082- 4C 57 F4   READ    JMP $F457
0162  2085- 4C 25 F4   WRITE   JMP $F425
0163  2088- 4C A7 F4   PREPDO  JMP $F4A7
0164  208B- 4C FD F5   DISCER1 JMP $F5FD
0165  208E- 4C 25 F6   ENDDO   JMP $F625
0166  2091- 4C 2C F6   PREPRD  JMP $F62C
0167  2094- 4C 51 F6   PREPWRA JMP $F651
0168  2097- 4C 6D F6   PREPWRB JMP $F66D
0169                   *
0170                   *
0171                   * P-CODE 01: RETN       (RETURN FROM PROCEDURE
0172                   *****************
0173                   * NO ARGUMENTS
0174                   *
0175  209A- A5 17      RETN    LDA BASE        SP=BASE-2
0176  209C- 38                 SEC
0177  209D- E9 02              SBC =2
0178  209F- 85 08              STA SP
0179  20A1- A5 18              LDA BASE+1
0180  20A3- E9 00              SBC =0
0181  20A5- 85 09              STA SP+1
0182  20A7- A0 80              LDY =128        GET STACK TOP ELEMENT
0183  20A9- B1 08              LDA (SP),Y
0184  20AB- 85 00              STA ACCU
0185  20AD- C8                 INY
0186  20AE- B1 08              LDA (SP),Y
0187  20B0- 85 01              STA ACCU+1
0188  20B2- A0 84              LDY =132
0189  20B4- B1 08              LDA (SP),Y      GET SAVED OLD BASE
0190  20B6- 85 17              STA BASE
0191  20B8- C8                 INY
0192  20B9- B1 08              LDA (SP),Y
0193  20BB- 85 18              STA BASE+1

----------------------------------------------------------------------

R65 PASCAL RUNTIME                 24/02/19   R65 ASSEMBLER  PAGE 05

0194  20BD- C8                 INY
0195  20BE- B1 08              LDA (SP),Y      AND RETURN ADDRESS
0196  20C0- 18                 CLC
0197  20C1- 69 02              ADC =2
0198  20C3- 85 0A              STA PC
0199  20C5- C8                 INY
0200  20C6- B1 08              LDA (SP),Y
0201  20C8- 69 00              ADC =0
0202  20CA- 85 0B              STA PC+1
0203  20CC- 60                 RTS
0204                   *
0205                   * P-CODE 02: NEGA       (NEGATE ACCU)
0206                   *****************
0207                   * NO ARGUMENTS
0208                   *
0209  20CD- A9 00      NEGA    LDA =0
0210  20CF- 38                 SEC
0211  20D0- E5 00              SBC ACCU
0212  20D2- 85 00              STA ACCU
0213  20D4- A9 00              LDA =0
0214  20D6- E5 01              SBC ACCU+1
0215  20D8- 85 01              STA ACCU+1
0216  20DA- 60                 RTS
0217                   *
0218                   * P-CODE 03: ADDA       (ADD)
0219                   *****************
0220                   * NO ARGUMENTS
0221                   *
0222  20DB- A0 7E      ADDA    LDY =126
0223  20DD- 18                 CLC
0224  20DE- B1 08              LDA (SP),Y
0225  20E0- 65 00              ADC ACCU
0226  20E2- 85 00              STA ACCU
0227  20E4- C8                 INY
0228  20E5- B1 08              LDA (SP),Y
0229  20E7- 65 01              ADC ACCU+1
0230  20E9- 85 01              STA ACCU+1
0231                   *
0232  20EB- A5 08      DECS2   LDA SP
0233  20ED- 38                 SEC
0234  20EE- E9 02              SBC =2
0235  20F0- 85 08              STA SP
0236  20F2- B0 02              BCS *+4
0237  20F4- C6 09              DEC SP+1
0238  20F6- 60                 RTS
0239                   *
0240                   * P-CODE 04: SUBA       (SUBTRACT)
0241                   *****************
0242                   * NO ARGUMENTS
0243                   *

----------------------------------------------------------------------

R65 PASCAL RUNTIME                 24/02/19   R65 ASSEMBLER  PAGE 06

0244  20F7- A0 7E      SUBA    LDY =126
0245  20F9- 38                 SEC
0246  20FA- B1 08              LDA (SP),Y
0247  20FC- E5 00              SBC ACCU
0248  20FE- 85 00             STA ACCU
0249  2100- C8                 INY
0250  2101- B1 08              LDA (SP),Y
0251  2103- E5 01              SBC ACCU+1
0252  2105- 85 01              STA ACCU+1
0253  2107- 4C EB 20           JMP DECS2
0254                   *
0255                   * P-CODE 05: MULA       (MULTIPLY)
0256                   *****************
0257                   * NO ARGUMENTS
0258                   *
0259  210A- 20 44 21   MULA    JSR GETSIGN     COMPUTE SIGN OF RESULT
0260  210D- A5 00              LDA ACCU
0261  210F- 78                 SEI
0262  2110- 8D E0 14           STA MULTA
0263  2113- A5 1B              LDA ARG1        GET SAVED ARGUMENT
0264  2115- 8D E1 14           STA MULTB
0265  2118- AD E2 14           LDA MULTR
0266  211B- 85 00              STA ACCU
0267  211D- AD E3 14           LDA MULTR+1
0268  2120- A6 1C              LDX ARG1+1
0269  2122- 8E E1 14           STX MULTB
0270  2125- 18                 CLC
0271  2126- 6D E2 14           ADC MULTR
0272  2129- A6 01              LDX ACCU+1
0273  212B- 8E E0 14           STX MULTA
0274  212E- A6 1B              LDX ARG1
0275  2130- 8E E1 14           STX MULTB
0276  2133- 18                 CLC
0277  2134- 6D E2 14           ADC MULTR
0278  2137- 58                 CLI
0279  2138- 29 7F              AND =$7F
0280  213A- 85 01              STA ACCU+1
0281  213C- 20 EB 20           JSR DECS2
0282  213F- A5 10              LDA SIGN
0283  2141- 30 8A              BMI NEGA
0284  2143- 60                 RTS
0285                   *
0286  2144- A5 01      GETSIGN LDA ACCU+1
0287  2146- 85 10              STA SIGN
0288  2148- 10 03              BPL *+5
0289  214A- 20 CD 20           JSR NEGA
0290                   *
0291  214D- A0 7F              LDY =127
0292  214F- B1 08              LDA (SP),Y
0293  2151- 10 14              BPL GETSI1

----------------------------------------------------------------------

R65 PASCAL RUNTIME                 24/02/19   R65 ASSEMBLER  PAGE 07

0294  2153- 45 10              EOR SIGN
0295  2155- 85 10              STA SIGN
0296  2157- 88                 DEY
0297  2158- A9 00              LDA =0
0298  215A- 38                 SEC
0299  215B- F1 08              SBC (SP),Y
0300  215D- 85 1B              STA ARG1
0301  215F- C8                 INY
0302  2160- A9 00              LDA =0
0303  2162- F1 08              SBC (SP),Y
0304  2164- 85 1C              STA ARG1+1
0305  2166- 60                 RTS
0306                   *
0307  2167- 85 1C      GETSI1  STA ARG1+1
0308  2169- 88                 DEY
0309  216A- B1 08              LDA (SP),Y
0310  216C- 85 1B              STA ARG1
0311  216E- 60                 RTS
0312                   *
0313                   * PCODE 06: DIVA        (DIVIDE)
0314                   ****************
0315                   *
0316  216F- A0 7E      DIVA    LDY =126
0317  2171- B1 08              LDA (SP),Y
0318  2173- 85 1B              STA ARG1
0319  2175- C8                 INY
0320  2176- B1 08              LDA (SP),Y
0321  2178- 85 1C              STA ARG1+1
0322  217A- 20 EB 20           JSR DECS2
0323                   *
0324  217D- A5 1C              LDA ARG1+1
0325  217F- 29 80              AND =$80
0326  2181- F0 02              BEQ *+4
0327  2183- A9 FF              LDA =$FF
0328  2185- 85 21              STA ARG2
0329  2187- 85 22              STA ARG2+1
0330  2189- AA                 TAX
0331  218A- 18                 CLC
0332  218B- 65 1B              ADC ARG1
0333  218D- 85 1B              STA ARG1
0334  218F- 8A                 TXA
0335  2190- 65 1C              ADC ARG1+1
0336  2192- 85 1C              STA ARG1+1
0337  2194- 8A                 TXA
0338  2195- 45 01              EOR ACCU+1
0339  2197- 85 10              STA SIGN
0340  2199- 10 03              BPL *+5
0341  219B- 20 CD 20           JSR NEGA
0342  219E- A0 11              LDY =$11
0343  21A0- A5 00              LDA ACCU

----------------------------------------------------------------------

R65 PASCAL RUNTIME                 24/02/19   R65 ASSEMBLER  PAGE 08

0344  21A2- 05 01              ORA ACCU+1
0345  21A4- D0 05              BNE DIV1
0346  21A6- A2 81              LDX =$81        PASCAL RUNTIME ERROR
0347  21A8- 4C E1 28           JMP PERROR      DIVISION BY ZERO
0348                   *
0349  21AB- 38         DIV1    SEC
0350  21AC- A5 21              LDA ARG2
0351  21AE- E5 00              SBC ACCU
0352  21B0- 48                 PHA
0353  21B1- A5 22              LDA ARG2+1
0354  21B3- E5 01              SBC ACCU+1
0355  21B5- 48                 PHA
0356  21B6- 45 22              EOR ARG2+1
0357  21B8- 30 09              BMI DIV2
0358  21BA- 68                 PLA
0359  21BB- 85 22              STA ARG2+1
0360  21BD- 68                 PLA
0361  21BE- 85 21              STA ARG2
0362  21C0- 38                 SEC
0363  21C1- B0 03              BCS DIV3
0364                   *
0365  21C3- 68         DIV2    PLA
0366  21C4- 68                 PLA
0367  21C5- 18                 CLC
0368  21C6- 26 1B      DIV3    ROL ARG1
0369  21C8- 26 1C              ROL ARG1+1
0370  21CA- 26 21              ROL ARG2
0371  21CC- 26 22              ROL ARG2+1
0372  21CE- 88                 DEY
0373  21CF- D0 DA              BNE DIV1
0374  21D1- A5 1B              LDA ARG1
0375  21D3- A6 1C              LDX ARG1+1
0376  21D5- 85 00              STA ACCU
0377  21D7- 86 01              STX ACCU+1
0378  21D9- A5 10              LDA SIGN
0379  21DB- 10 03              BPL *+5
0380  21DD- 4C CD 20           JMP NEGA
0381  21E0- 60                 RTS
0382                   *
0383                   * P-CODE 07: LOWB       (LOW BIT)
0384                   *****************
0385                   * NO ARGUMENTS
0386                   *
0387  21E1- A5 00      LOWB    LDA ACCU
0388  21E3- 29 01              AND =1
0389  21E5- 85 00      LOWB1   STA ACCU
0390  21E7- A9 00              LDA =0
0391  21E9- 85 01              STA ACCU+1
0392  21EB- 60                 RTS
0393                   *

----------------------------------------------------------------------

R65 PASCAL RUNTIME                 24/02/19   R65 ASSEMBLER  PAGE 09

0394                   * P-CODE 08: TEQU       (TEST EQUAL)
0395                   *****************
0396                   *
0397  21EC- 20 F7 20   TEQU    JSR SUBA
0398  21EF- A5 00              LDA ACCU
0399  21F1- 05 01              ORA ACCU+1
0400  21F3- F0 04              BEQ TEQU1
0401  21F5- A9 00              LDA =0
0402  21F7- F0 EC              BEQ LOWB1       UNCOND.
0403                   *
0404  21F9- A9 01      TEQU1   LDA =1
0405  21FB- D0 E8              BNE LOWB1       UNCOND.
0406                   *
0407                   * PCODE 09: TNEQ        (TEST NOT EQUAL)
0408                   ****************
0409                   *
0410  21FD- 20 EC 21  TNEQ    JSR TEQU
0411  2200- A5 00              LDA ACCU
0412  2202- 49 01              EOR =1
0413  2204- 85 00              STA ACCU
0414  2206- 60                 RTS
0415                   *
0416                   * P-CODE 0A: TLES       (TEST LESS)
0417                   *****************
0418                   *
0419  2207- 20 F7 20   TLES    JSR SUBA
0420  220A- A9 00              LDA =0
0421  220C- 06 01              ASL ACCU+1
0422  220E- 2A                 ROL A
0423  220F- 90 D4              BCC LOWB1       UNCOND.
0424                   *
0425                   * P-CODE 0B: TGRE       (TEST GREATER OR EQUAL)
0426                   *****************
0427                   *
0428  2211- 20 07 22   TGRE    JSR TLES
0429  2214- 4C 00 22           JMP TNEQ+3
0430                   *
0431                   * P-CODE 0C: TGRTS      (TEST GREATER)
0432                   ******************
0433                   *
0434  2217- 20 F5 26   TGRT    JSR EXST
0435  221A- 4C 07 22           JMP TLES
0436                   *
0437                   * P-CODE 0D: TLEE       (TEST LESS OR EQUAL)
0438                   *****************
0439                   *
0440  221D- 20 17 22   TLEE    JSR TGRT
0441  2220- 4C 00 22           JMP TNEQ+3
0442                   *
0443                   * P-CODE 0E: ORAC       (BITWISE OR)

----------------------------------------------------------------------

R65 PASCAL RUNTIME                 24/02/19   R65 ASSEMBLER  PAGE 10

0444                   *****************
0445                   *
0446  2223- A0 7E      ORAC    LDY =126
0447  2225- B1 08              LDA (SP),Y
0448  2227- 05 00              ORA ACCU
0449  2229- 85 00              STA ACCU
0450  222B- C8                 INY
0451  222C- B1 08              LDA (SP),Y
0452  222E- 05 01              ORA ACCU+1
0453  2230- 85 01              STA ACCU+1
0454  2232- 4C EB 20           JMP DECS2
0455                   *
0456                   * P-CODE 0F: ANDA       (BITWISE AND)
0457                   *****************
0458                   *
0459  2235- A0 7E      ANDA    LDY =126
0460  2237- B1 08              LDA (SP),Y
0461  2239- 25 00              AND ACCU
0462  223B- 85 00              STA ACCU
0463  223D- C8                 INY
0464  223E- B1 08              LDA (SP),Y
0465  2240- 25 01              AND ACCU+1
0466  2242- 85 01              STA ACCU+1
0467  2244- 4C EB 20           JMP DECS2
0468                   *
0469                   * PCODE 10: EORA        (BITWISE OR)
0470                   ****************
0471                   *
0472  2247- A0 7E      EORA    LDY =126
0473  2249- B1 08              LDA (SP),Y
0474  224B- 45 00              EOR ACCU
0475  224D- 85 00              STA ACCU
0476  224F- C8                 INY
0477  2250- B1 08              LDA (SP),Y
0478  2252- 45 01              EOR ACCU+1
0479  2254- 85 01              STA ACCU+1
0480  2256- 4C EB 20           JMP DECS2
0481                   *
0482                   * P-CODE 11: NOTA       (BITWISE NOT)
0483                   *****************
0484                   *
0485  2259- A5 00      NOTA    LDA ACCU
0486  225B- 49 FF              EOR =$FF
0487  225D- 85 00              STA ACCU
0488  225F- A5 01              LDA ACCU+1
0489  2261- 49 FF              EOR =$FF
0490  2263- 85 01              STA ACCU+1
0491  2265- 60                 RTS
0492                   *
0493                   * P-CODE 12: LEFT       (SHIFT LEFT N BYTES)

----------------------------------------------------------------------

R65 PASCAL RUNTIME                 24/02/19   R65 ASSEMBLER  PAGE 11

0494                   *****************
0495                   *
0496  2266- 20 CD 20           JSR NEGA
0497  2269- A5 01      LEFT    LDA ACCU+1
0498  226B- 30 12              BMI RIGH-3      ARGUMENT NEGATIVE
0499                   *
0500  226D- A6 00              LDX ACCU
0501  226F- F0 0B              BEQ LEFT2       TAKE ONLY LOW BYTE
0502  2271- 20 DC 22           JSR GETS2       GET SECOND NO FROM ST
0503  2274- 06 00      LEFT1   ASL ACCU
0504  2276- 26 01              ROL ACCU+1
0505  2278- CA                 DEX
0506  2279- D0 F9              BNE LEFT1
0507  227B- 60                 RTS
0508                   *
0509  227C- 4C DC 22   LEFT2   JMP GETS2
0510                   *
0511                   * P-CODE 13: RIGH       (SHIFT RIGHT N BYTES)
0512                   *****************
0513                   *
0514  227F- 20 CD 20           JSR NEGA
0515  2282- A5 01      RIGH    LDA ACCU+1
0516  2284- 30 E0              BMI LEFT-3
0517  2286- A6 00              LDX ACCU
0518  2288- F0 F2              BEQ LEFT2
0519  228A- 20 DC 22           JSR GETS2
0520  228D- 46 01      RIGH1   LSR ACCU+1
0521  228F- A9 00              LDA =0
0522  2291- 90 02              BCC *+4
0523  2293- A9 80              LDA =128
0524  2295- 46 00              LSR ACCU
0525  2297- 05 00              ORA ACCU
0526  2299- 85 00              STA ACCU
0527  229B- CA                 DEX
0528  229C- D0 EF              BNE RIGH1
0529  229E- 60                 RTS
0530                   *
0531                   * P-CODE 14:INCA        (INCREMENT ACCU)
0532                   ****************
0533                   *
0534  229F- E6 00      INCA    INC ACCU
0535  22A1- D0 02              BNE *+4
0536  22A3- E6 01              INC ACCU+1
0537  22A5- 60                 RTS
0538                   *
0539                   * P-CODE 15: DECA       (DECREMENT ACCU)
0540                   *****************
0541                   *
0542  22A6- A5 00      DECA    LDA ACCU
0543  22A8- D0 02              BNE *+4

----------------------------------------------------------------------

R65 PASCAL RUNTIME                 24/02/19   R65 ASSEMBLER  PAGE 12

0544  22AA- C6 01              DEC ACCU+1
0545  22AC- C6 00              DEC ACCU
0546  22AE- 60                 RTS
0547                   *
0548                   * P-CODE 16: COPY       (COPY ACCU0
0549                   *****************
0550                   *
0551  22AF- 20 BE 22   COPY    JSR INCS2       INCREMENT STACK
0552  22B2- A0 7E              LDY =126
0553  22B4- A5 00              LDA ACCU
0554  22B6- 91 08              STA (SP),Y
0555  22B8- C8                 INY
0556  22B9- A5 01              LDA ACCU+1
0557  22BB- 91 08              STA (SP),Y
0558  22BD- 60                 RTS
0559                   *
0560  22BE- A9 02      INCS2   LDA =2
0561  22C0- 18                 CLC
0562  22C1- 65 08              ADC SP
0563  22C3- 85 08              STA SP
0564  22C5- 90 02              BCC *+4
0565  22C7- E6 09              INC SP+1
0566  22C9- C5 0E      INCS2A  CMP ENDSTK      TEST STACK OVERFLOW
0567  22CB- A5 09              LDA SP+1
0568  22CD- E5 0F              SBC ENDSTK+1
0569  22CF- B0 06              BCS INCS2B
0570  22D1- A9 05              LDA =5          LET EMULATOR KNOW THAT
0571  22D3- 8D 30 14           STA EMUCOM      SP HAS BEEN INCREASED
0572  22D6- 60                 RTS
0573                   *
0574  22D7- A0 82      INCS2B  LDY =$82        PASCAL RUN TIME ERROR
0575  22D9- 4C E1 28           JMP PERROR      STACK OVERFLOW
0576                   *
0577                   * GETS2
0578                   *
0579  22DC- A0 7E      GETS2   LDY =126
0580  22DE- B1 08              LDA (SP),Y
0581  22E0- 85 00              STA ACCU
0582  22E2- C8                 INY
0583  22E3- B1 08              LDA (SP),Y
0584  22E5- 85 01              STA ACCU+1
0585  22E7- 4C EB 20           JMP DECS2
0586                   *
0587                   * P-CODE 17: PEEK
0588                   *****************
0589                   *
0590  22EA- A0 00      PEEK    LDY =0
0591  22EC- B1 00              LDA (ACCU),Y
0592  22EE- 85 00              STA ACCU
0593  22F0- 84 01              STY ACCU+1

----------------------------------------------------------------------

R65 PASCAL RUNTIME                 24/02/19   R65 ASSEMBLER  PAGE 13

0594  22F2- 60                 RTS
0595                   *
0596                   * P-CODE 18: POKE
0597                   *****************
0598                   *
0599  22F3- A6 00      POKE    LDX ACCU
0600  22F5- 20 DC 22           JSR GETS2
0601  22F8- A0 00              LDY =0
0602  22FA- 8A                 TXA
0603  22FB- 91 00              STA (ACCU),Y
0604  22FD- 4C DC 22          JMP GETS2
0605                   *
0606                   * P-CODE 19: CALA
0607                   *****************
0608                   *
0609  2300- 20 06 23   CALA    JSR CALA1
0610  2303- 4C DC 22           JMP GETS2
0611                   *
0612  2306- 6C 00 00   CALA1   JMP (ACCU)
0613                   *
0614                   * P-CODE 1A: RLIN
0615                   *****************
0616                   *
0617  2309- 20 06 E0   RLIN    JSR GETLIN
0618  230C- B0 27              BCS RLINESC     IF ESC
0619  230E- A2 00              LDX =0
0620  2310- B1 E9              LDA (VIDPNT),Y
0621  2312- 29 7F              AND =$7F
0622  2314- 95 24              STA LINBUF,X
0623  2316- E8                 INX
0624  2317- C8                 INY
0625  2318- CC 8A 17           CPY NUMCHR
0626  231B- 90 F3              BCC *-11
0627  231D- F0 F1              BEQ *-13
0628  231F- CA                 DEX
0629  2320- 30 06              BMI *+8
0630  2322- B5 24              LDA LINBUF,X
0631  2324- C9 20              CMP =$20
0632  2326- F0 F7              BEQ *-7
0633  2328- E8                 INX
0634  2329- 86 16              STX ENDBUF
0635  232B- A9 00              LDA =0
0636  232D- 85 15              STA BUFFPN
0637  232F- 20 27 E0           JSR PRTINF
0638  2332- 0D 8A              BYT $D,$8A
0639  2334- 60                 RTS
0640                   *
0641  2335- 4C 10 20   RLINESC JMP STOP        ESCAPE
0642                   *
0643                   * P-CODE 1B: GETC

----------------------------------------------------------------------

R65 PASCAL RUNTIME                 24/02/19   R65 ASSEMBLER  PAGE 14

0644                   *****************
0645                   *
0646  2338- 20 AF 22   GETC    JSR COPY
0647  233B- 20 99 28           JSR GETCHR0
0648  233E- 85 00      GETC1   STA ACCU
0649  2340- A9 00              LDA =0
0650  2342- 85 01              STA ACCU+1
0651  2344- 60                 RTS
0652                   *
0653                   * P-CODE 1C: GETN
0654                   *****************
0655                   *
0656  2345- 20 AF 22   GETN    JSR COPY
0657  2348- A9 00              LDA =0
0658  234A- 85 00              STA ACCU
0659  234C- 85 01              STA ACCU+1
0660  234E- 85 10              STA SIGN
0661  2350- 20 99 28   GETN0   JSR GETCHR0
0662  2353- C9 20              CMP =' '
0663  2355- F0 F9              BEQ GETN0
0664  2357- C9 2D              CMP ='-'
0665  2359- D0 05              BNE GETN1
0666                   *
0667  235B- C6 10              DEC SIGN
0668  235D- 4C 64 23           JMP GETN2
0669                   *
0670  2360- C9 2B      GETN1    CMP ='+'
0671  2362- D0 03              BNE GETN2+3
0672                   *
0673  2364- 20 99 28   GETN2   JSR GETCHR0
0674  2367- C9 30              CMP ='0'
0675  2369- 90 2F              BCC GETN3
0676  236B- C9 3A              CMP ='9'+1
0677  236D- B0 2B              BCS GETN3
0678  236F- 38                 SEC
0679  2370- E9 30              SBC ='0'
0680  2372- 48                 PHA
0681  2373- 06 00              ASL ACCU
0682  2375- 26 01              ROL ACCU+1
0683  2377- A6 00              LDX ACCU
0684  2379- A4 01              LDY ACCU+1
0685  237B- 06 00              ASL ACCU
0686  237D- 26 01              ROL ACCU+1
0687  237F- 06 00              ASL ACCU
0688  2381- 26 01              ROL ACCU+1
0689  2383- 18                 CLC
0690  2384- 8A                 TXA
0691  2385- 65 00              ADC ACCU
0692  2387- 85 00              STA ACCU
0693  2389- 98                 TYA

----------------------------------------------------------------------

R65 PASCAL RUNTIME                 24/02/19   R65 ASSEMBLER  PAGE 15

0694  238A- 65 01              ADC ACCU+1
0695  238C- 85 01              STA ACCU+1
0696  238E- 68                 PLA
0697  238F- 18                 CLC
0698  2390- 65 00              ADC ACCU
0699  2392- 85 00              STA ACCU
0700  2394- 90 CE              BCC GETN2
0701  2396- E6 01              INC ACCU+1
0702  2398- B0 CA              BCS GETN2
0703                   *
0704  239A- A5 10      GETN3   LDA SIGN
0705  239C- F0 03              BEQ *+5
0706  239E- 4C CD 20           JMP NEGA
0707  23A1- 60                 RTS
0708                   *
0709                   * P-CODE 1D: PRTC
0710                   *****************
0711                   *
0712  23A2- A5 00      PRTC    LDA ACCU
0713  23A4- 20 C9 28           JSR PRTCHR0
0714  23A7- 4C DC 22           JMP GETS2
0715                   *
0716                   * P-CODE 1E: PRTN
0717                   *****************
0718                   *
0719  23AA- A5 01      PRTN    LDA ACCU+1
0720  23AC- 10 08              BPL PRTN1
0721  23AE- 20 CD 20           JSR NEGA
0722  23B1- A9 2D              LDA ='-'
0723  23B3- 20 C9 28           JSR PRTCHR0
0724                   *
0725  23B6- A5 00      PRTN1   LDA ACCU
0726  23B8- A6 01              LDX ACCU+1
0727  23BA- 85 21              STA ARG2
0728  23BC- 86 22              STX ARG2+1
0729  23BE- A9 1F              LDA =$1F
0730  23C0- 85 1D              STA ARG3
0731  23C2- 85 1F              STA ARG3+2
0732  23C4- A9 2A              LDA =$2A
0733  23C6- 85 1E              STA ARG3+1
0734  23C8- 85 20              STA ARG3+3
0735  23CA- A6 21              LDX ARG2
0736  23CC- A4 22              LDY ARG2+1
0737  23CE- 38                 SEC
0738  23CF- E6 1D      PRTN2   INC ARG3
0739  23D1- 8A                 TXA
0740  23D2- E9 10              SBC =$10
0741  23D4- AA                 TAX
0742  23D5- 98                 TYA
0743  23D6- E9 27              SBC =$27

----------------------------------------------------------------------

R65 PASCAL RUNTIME                 24/02/19   R65 ASSEMBLER  PAGE 16

0744  23D8- A8                 TAY
0745  23D9- B0 F4              BCS PRTN2
0746  23DB- C6 1E      PRTN3   DEC ARG3+1
0747  23DD- 8A                 TXA
0748  23DE- 69 E8              ADC =$E8
0749  23E0- AA                 TAX
0750  23E1- 98                 TYA
0751  23E2- 69 03              ADC =$03
0752  23E4- A8                 TAY
0753  23E5- 90 F4              BCC PRTN3
0754  23E7- 8A                 TXA
0755  23E8- 38         PRTN4   SEC
0756  23E9- E6 1F      PRTN5   INC ARG3+2
0757  23EB- E9 64              SBC =$64
0758  23ED- B0 FA              BCS PRTN5
0759  23EF- 88                 DEY
0760  23F0- 10 F6              BPL PRTN4
0761  23F2- C6 20      PRTN6   DEC ARG3+3
0762  23F4- 69 0A              ADC =$A
0763  23F6- 90 FA              BCC PRTN6
0764  23F8- 09 30              ORA =$30
0765  23FA- 85 21              STA ARG2
0766  23FC- A9 20              LDA =$20
0767  23FE- 85 22             STA ARG2+1
0768  2400- A2 FB              LDX =$FB
0769  2402- 86 10      PRTN7   STX SIGN
0770  2404- B5 22              LDA ARG2+1,X
0771  2406- 05 22              ORA ARG2+1
0772  2408- C9 20              CMP =$20
0773  240A- F0 09              BEQ PRTN8
0774  240C- A0 30              LDY =$30
0775  240E- 84 22              STY ARG2+1
0776  2410- 05 22              ORA ARG2+1
0777  2412- 20 C9 28           JSR PRTCHR0
0778  2415- A6 10      PRTN8   LDX SIGN
0779  2417- E8                 INX
0780  2418- D0 E8              BNE PRTN7
0781  241A- 4C DC 22           JMP GETS2
0782                   *
0783                   * P-CODE 1F: PRTS
0784                   *****************
0785                   *
0786  241D- 06 00      PRTS    ASL ACCU
0787  241F- 26 01              ROL ACCU+1
0788  2421- A5 08              LDA SP
0789  2423- 38                 SEC
0790  2424- E5 00              SBC ACCU
0791  2426- 85 00              STA ACCU
0792  2428- 48                 PHA
0793  2429- A5 09              LDA SP+1

----------------------------------------------------------------------

R65 PASCAL RUNTIME                 24/02/19   R65 ASSEMBLER  PAGE 17

0794  242B- E5 01              SBC ACCU+1
0795  242D- 85 01              STA ACCU+1
0796  242F- 48                 PHA
0797  2430- A0 80      OUTST1  LDY =128
0798  2432- B1 00              LDA (ACCU),Y
0799  2434- 20 C9 28           JSR PRTCHR0
0800  2437- A5 00              LDA ACCU
0801  2439- 18                 CLC
0802  243A- 69 02              ADC =2
0803  243C- 85 00              STA ACCU
0804  243E- 90 02              BCC *+4
0805  2440- E6 01              INC ACCU+1
0806  2442- C5 08              CMP SP
0807  2444- A5 01              LDA ACCU+1
0808  2446- E5 09              SBC SP+1
0809  2448- 90 E6              BCC OUTST1
0810  244A- 68                 PLA
0811  244B- 85 09              STA SP+1
0812  244D- 68                 PLA
0813  244E- 85 08              STA SP
0814  2450- 4C DC 22           JMP GETS2
0815                   *
0816                   * P-CODE 20: LITB
0817                   *****************
0818                   *
0819  2453- 20 AF 22   LITB    JSR COPY
0820  2456- 20 9D 24           JSR FETCH
0821  2459- 85 00              STA ACCU
0822  245B- A9 00              LDA =0
0823  245D- 85 01              STA ACCU+1
0824  245F- 60                 RTS
0825                   *
0826                   * P-CODE 21: INCB
0827                   *****************
0828                   *
0829  2460- A0 80      INCB    LDY =128        SAVE CURRENT ACCU
0830  2462- A5 00              LDA ACCU
0831  2464- 91 08              STA (SP),Y
0832  2466- C8                 INY
0833  2467- A5 01              LDA ACCU+1
0834  2469- 91 08              STA (SP),Y
0835  246B- 20 9D 24           JSR FETCH
0836  246E- A2 00              LDX =0
0837  2470- A8                 TAY             TEST A
0838  2471- 10 01              BPL *+3
0839  2473- CA                 DEX
0840  2474- 18                 CLC
0841  2475- 65 08              ADC SP
0842  2477- 85 08              STA SP
0843  2479- 8A                 TXA

----------------------------------------------------------------------

R65 PASCAL RUNTIME                 24/02/19   R65 ASSEMBLER  PAGE 18

0844  247A- 65 09              ADC SP+1
0845  247C- 85 09              STA SP+1
0846  247E- A5 08      INCB1   LDA SP
0847  2480- 20 C9 22           JSR INCS2A      TEST STACK OVERFLOW
0848  2483- A0 80              LDY =128        AND GET NEW ACCU
0849  2485- B1 08              LDA (SP),Y
0850  2487- 85 00              STA ACCU
0851  2489- C8                 INY
0852  248A- B1 08              LDA (SP),Y
0853  248C- 85 01              STA ACCU+1
0854  248E- 60                 RTS
0855                   *
0856                   * P-CODE 22: LITW
0857                   *****************
0858                   *
0859  248F- 20 AF 22   LITW    JSR COPY
0860  2492- 20 9D 24           JSR FETCH
0861  2495- 85 00              STA ACCU
0862  2497- 20 9D 24           JSR FETCH
0863  249A- 85 01              STA ACCU+1
0864  249C- 60                 RTS
0865                   *
0866                   * FETCH
0867                   *
0868  249D- A0 00      FETCH   LDY =0
0869  249F- B1 0A              LDA (PC),Y
0870  24A1- E6 0A              INC PC
0871  24A3- D0 02              BNE *+4
0872  24A5- E6 0B              INC PC+1
0873  24A7- 60                 RTS
0874                   *
0875                   * P-CODE 23: INCW
0876                   *****************
0877                   *
0878  24A8- A0 80      INCW    LDY =128        SAVE CURRENT ACCU
0879  24AA- A5 00              LDA ACCU
0880  24AC- 91 08              STA (SP),Y
0881  24AE- C8                 INY
0882  24AF- A5 01              LDA ACCU+1
0883  24B1- 91 08              STA (SP),Y
0884  24B3- 20 9D 24           JSR FETCH
0885  24B6- 18                 CLC
0886  24B7- 65 08              ADC SP
0887  24B9- 85 08              STA SP
0888  24BB- 20 9D 24           JSR FETCH
0889  24BE- 65 09              ADC SP+1
0890  24C0- 85 09              STA SP+1
0891  24C2- 4C 7E 24           JMP INCB1
0892                   *
0893                   * P-CODE 24: JUMP

----------------------------------------------------------------------

R65 PASCAL RUNTIME                 24/02/19   R65 ASSEMBLER  PAGE 19

0894                   *****************
0895                   *
0896  24C5- A0 00      JUMP    LDY =0
0897  24C7- B1 0A              LDA (PC),Y
0898  24C9- 18                 CLC
0899  24CA- 65 0A              ADC PC
0900  24CC- AA                 TAX
0901  24CD- C8                 INY
0902  24CE- B1 0A              LDA (PC),Y
0903  24D0- 65 0B              ADC PC+1
0904  24D2- 86 0A              STX PC
0905  24D4- 85 0B              STA PC+1
0906  24D6- 60                 RTS
0907                   *
0908                   * P-CODE 25: JMPZ
0909                   *****************
0910                   *
0911  24D7- 46 00      JMPZ    LSR ACCU
0912  24D9- 08                 PHP
0913  24DA- 20 DC 22           JSR GETS2
0914  24DD- 28                 PLP
0915  24DE- 90 E5              BCC JUMP
0916                   *
0917  24E0- A5 0A              LDA PC
0918  24E2- 18                 CLC
0919  24E3- 69 02              ADC =2
0920  24E5- 85 0A              STA PC
0921  24E7- 90 02              BCC *+4
0922  24E9- E6 0B              INC PC+1
0923  24EB- 60                 RTS
0924                   *
0925                   * P-CODE 26: JMPO
0926                   *****************
0927                   *
0928  24EC- A5 00      JMPO    LDA ACCU
0929  24EE- 49 01              EOR =1
0930  24F0- 85 00              STA ACCU
0931  24F2- 4C D7 24           JMP JMPZ
0932                   *
0933                   * P-CODE 27: LOAD
0934                   *****************
0935                   *
0936  24F5- 20 AF 22   LOAD    JSR COPY
0937  24F8- 20 9D 24           JSR FETCH
0938  24FB- AA                 TAX             LEVEL DIFFERENCE
0939  24FC- 20 9D 24           JSR FETCH
0940  24FF- 85 1B             STA ARG1
0941  2501- 20 9D 24           JSR FETCH
0942  2504- 85 1C      LOAD1   STA ARG1+1
0943  2506- 20 32 25           JSR FBASE3

----------------------------------------------------------------------

R65 PASCAL RUNTIME                 24/02/19   R65 ASSEMBLER  PAGE 20

0944  2509- A0 80      LOAD2   LDY =128
0945  250B- B1 19              LDA (ABASE),Y
0946  250D- 85 00              STA ACCU
0947  250F- C8                 INY
0948  2510- B1 19              LDA (ABASE),Y
0949  2512- 85 01              STA ACCU+1
0950  2514- 60                 RTS
0951                   *
0952                   * FBASE
0953                   *
0954  2515- A5 17      FBASE   LDA BASE
0955  2517- A4 18              LDY BASE+1
0956  2519- 85 19              STA ABASE
0957  251B- 84 1A              STY ABASE+1
0958  251D- E0 00              CPX =0
0959  251F- F0 10              BEQ FBASE2
0960                   *
0961  2521- A0 80      FBASE1  LDY =128
0962  2523- B1 19              LDA (ABASE),Y
0963  2525- 48                 PHA
0964  2526- C8                 INY
0965  2527- B1 19              LDA (ABASE),Y
0966  2529- 85 1A              STA ABASE+1
0967  252B- 68                 PLA
0968  252C- 85 19              STA ABASE
0969  252E- CA                 DEX
0970  252F- D0 F0              BNE FBASE1
0971  2531- 60         FBASE2  RTS
0972                   *
0973  2532- 20 15 25   FBASE3  JSR FBASE
0974  2535- 18                 CLC
0975  2536- A5 1B              LDA ARG1
0976  2538- 65 19              ADC ABASE
0977  253A- 85 19              STA ABASE
0978  253C- A5 1C              LDA ARG1+1
0979  253E- 65 1A              ADC ABASE+1
0980  2540- 85 1A              STA ABASE+1
0981  2542- 60                 RTS
0982                   *
0983                   * P-CODE 28: LODX
0984                   *****************
0985                   *
0986  2543- 20 9D 24   LODX    JSR FETCH
0987  2546- AA                 TAX
0988  2547- 20 9D 24           JSR FETCH
0989  254A- 06 00              ASL ACCU
0990  254C- 26 01              ROL ACCU+1
0991  254E- 18                 CLC
0992  254F- 65 00              ADC ACCU
0993  2551- 85 1B              STA ARG1

----------------------------------------------------------------------

R65 PASCAL RUNTIME                 24/02/19   R65 ASSEMBLER  PAGE 21

0994  2553- 08                 PHP
0995  2554- 20 9D 24           JSR FETCH
0996  2557- 28                 PLP
0997  2558- 65 01              ADC ACCU+1
0998  255A- 4C 04 25           JMP LOAD1
0999                   *
1000                   * P-CODE 29: STOR
1001                   *****************
1002                   *
1003  255D- 20 9D 24   STOR    JSR FETCH
1004  2560- AA                 TAX
1005  2561- 20 9D 24           JSR FETCH
1006  2564- 85 1B              STA ARG1
1007  2566- 20 9D 24           JSR FETCH
1008  2569- 85 1C              STA ARG1+1
1009  256B- 20 32 25   STOR1   JSR FBASE3
1010  256E- A0 80      STOR2   LDY =128
1011  2570- A5 00              LDA ACCU
1012  2572- 91 19              STA (ABASE),Y
1013  2574- C8                 INY
1014  2575- A5 01              LDA ACCU+1
1015  2577- 91 19              STA (ABASE),Y
1016  2579- 4C DC 22           JMP GETS2
1017                   *
1018                   * P-CODE 2A: STOX
1019                   *****************
1020                   *
1021  257C- 20 9D 24   STOX    JSR FETCH
1022  257F- AA                 TAX
1023  2580- A0 7E              LDY =126
1024  2582- B1 08              LDA (SP),Y
1025  2584- 0A                 ASL A
1026  2585- 85 1B              STA ARG1
1027  2587- C8                 INY
1028  2588- B1 08              LDA (SP),Y
1029  258A- 2A                 ROL A
1030  258B- 85 1C              STA ARG1+1
1031  258D- 20 9D 24           JSR FETCH
1032  2590- 18                 CLC
1033  2591- 65 1B              ADC ARG1
1034  2593- 85 1B              STA ARG1
1035  2595- 20 9D 24           JSR FETCH
1036  2598- 65 1C              ADC ARG1+1
1037  259A- 85 1C              STA ARG1+1
1038  259C- 20 EB 20           JSR DECS2
1039  259F- 4C 6B 25           JMP STOR1
1040                   *
1041                   * P-CODE 2B: CALL
1042                   *****************
1043                   *

----------------------------------------------------------------------

R65 PASCAL RUNTIME                 24/02/19   R65 ASSEMBLER  PAGE 22

1044  25A2- 20 9D 24   CALL    JSR FETCH
1045  25A5- AA                 TAX
1046  25A6- 20 15 25           JSR FBASE
1047  25A9- A0 82              LDY =130
1048  25AB- A5 19              LDA ABASE
1049  25AD- 91 08              STA (SP),Y
1050  25AF- C8                 INY
1051  25B0- A5 1A              LDA ABASE+1
1052  25B2- 91 08              STA (SP),Y
1053  25B4- C8                 INY
1054  25B5- A5 17              LDA BASE
1055  25B7- 91 08              STA (SP),Y
1056  25B9- C8                 INY
1057  25BA- A5 18              LDA BASE+1
1058  25BC- 91 08              STA (SP),Y
1059  25BE- C8                 INY
1060  25BF- A5 0A              LDA PC
1061  25C1- 91 08              STA (SP),Y
1062  25C3- C8                 INY
1063  25C4- A5 0B              LDA PC+1
1064  25C6- 91 08              STA (SP),Y
1065  25C8- A5 08              LDA SP
1066  25CA- 18                 CLC
1067  25CB- 69 02              ADC =2
1068  25CD- 85 17              STA BASE
1069  25CF- A5 09              LDA SP+1
1070  25D1- 69 00              ADC =0
1071  25D3- 85 18              STA BASE+1
1072  25D5- 4C C5 24           JMP JUMP
1073                   *
1074                   * PCODE 2C: SDEV
1075                   ****************
1076                   *
1077  25D8- A5 00      SDEV    LDA ACCU
1078  25DA- 85 0D              STA DEVICE
1079  25DC- 4C DC 22           JMP GETS2
1080                   *
1081                   * PCODE 2D: RDEV
1082                   ****************
1083                   *
1084  25DF- A9 00      RDEV    LDA =0
1085  25E1- 85 0D              STA DEVICE
1086  25E3- 60                 RTS
1087                   *
1088                   * PCODE 2E: FNAM
1089                   ****************
1090                   *
1091  25E4- 20 27 E0   FNAM    JSR PRTINF
1092  25E7- 20 3D A0           BYT ' = '+128
1093  25EA- 20 06 E0           JSR GETLIN

----------------------------------------------------------------------

R65 PASCAL RUNTIME                 24/02/19   R65 ASSEMBLER  PAGE 23

1094  25ED- 20 15 F8           JSR GETNAM
1095  25F0- 20 0D 20           JSR HARGUM
1096  25F3- 85 DC              STA FILDRV
1097  25F5- 20 0D 20           JSR HARGUM
1098  25F8- 8D 13 03           STA FILLOC
1099  25FB- 20 27 E0           JSR PRTINF
1100  25FE- 0D 8A             BYT $D,$8A
1101  2600- 60                 RTS
1102                   *
1103                   * P-CODE 2F: OPNR
1104                   *****************
1105                   *
1106                   * NO AUTOMATIC ERROR TESTING
1107                   *
1108  2601- A9 00      OPNR    LDA =0
1109  2603- 85 DA              STA FILFLG
1110  2605- 20 AF 22           JSR COPY
1111  2608- 20 0F F0           JSR OPEN
1112  260B- C8                 INY
1113  260C- C8                 INY
1114  260D- 84 00              STY ACCU
1115  260F- 85 01              STA ACCU+1
1116  2611- 60                 RTS
1117                   *
1118                   * P-CODE 30: OPNW
1119                   *****************
1120                   *
1121  2612- A9 20      OPNW    LDA =$20
1122  2614- 4C 03 26           JMP OPNR+2
1123                   *
1124                   * P-CODE 31: CLOS
1125                   *****************
1126                   *
1127                   * NO AUTOMATIC ERROR CHECKING
1128                   *
1129  2617- A6 00      CLOS    LDX ACCU
1130  2619- CA                 DEX
1131  261A- CA                 DEX
1132  261B- 20 1E 2D           JSR CLOSRA
1133  261E- 4C DC 22           JMP GETS2
1134                   *
1135                   * P-CODE 32: PRTI
1136                   *****************
1137                   *
1138  2621- 20 9D 24   PRTI    JSR FETCH
1139  2624- 48                 PHA
1140  2625- 29 7F              AND =$7F
1141  2627- 20 C9 28           JSR PRTCHR0
1142  262A- 68                 PLA
1143  262B- 10 F4              BPL PRTI

----------------------------------------------------------------------

R65 PASCAL RUNTIME                 24/02/19   R65 ASSEMBLER  PAGE 24

1144  262D- 60                 RTS
1145                   *
1146                   * P-CODE 33: GHGH       (GET HIGH)
1147                   *****************
1148                   *
1149  262E- A5 01      GHGH    LDA ACCU+1
1150  2630- 85 00              STA ACCU
1151                   *
1152                   * P-CODE 34: GLOW
1153                   *****************
1154                   *
1155  2632- A9 00      GLOW    LDA =0
1156  2634- 85 01              STA ACCU+1
1157  2636- 60                 RTS
1158                   *
1159                   * P-CODE 35:PHGH
1160                   ****************
1161                   *
1162  2637- A0 7E      PHGH    LDY =126
1163  2639- B1 08              LDA (SP),Y
1164  263B- 85 01              STA ACCU+1
1165  263D- 4C EB 20           JMP DECS2
1166                   *
1167                   * P-CODE 36: PLOW
1168                   *****************
1169                   *
1170  2640- A0 7E      PLOW    LDY =126
1171  2642- B1 08              LDA (SP),Y
1172  2644- 85 00              STA ACCU
1173  2646- 4C EB 20           JMP DECS2
1174                   *
1175                   * P-CODE 37: GSEC
1176                   *****************
1177                   * DEVICE HAS TO BE SET  ########
1178                   *
1179  2649- 20 5B 26   GSEC    JSR PREPSEC
1180  264C- 4C 82 20           JMP READ
1181  264F- 4C 8E 20           JMP ENDDO
1182                   *
1183                   * P-CODE 38: PSEC
1184                   *****************
1185                   * DEVICE HAS TO BE SET  ########
1186                   *
1187  2652- 20 5B 26   PSEC    JSR PREPSEC
1188  2655- 20 85 20           JSR WRITE
1189  2658- 4C 8E 20           JMP ENDDO
1190                   *
1191  265B- EA         PREPSEC NOP             ########
1192  265C- EA                 NOP
1193  265D- EA                 NOP

----------------------------------------------------------------------

R65 PASCAL RUNTIME                 24/02/19   R65 ASSEMBLER  PAGE 25

1194  265E- EA                 NOP
1195  265F- A5 00              LDA ACCU
1196  2661- A6 01              LDX ACCU+1
1197  2663- 85 E0              STA DATA
1198  2665- 86 E1              STX DATA+1
1199  2667- A0 7E              LDY =126
1200  2669- B1 08              LDA (SP),Y
1201  266B- 85 DE              STA SECTOR
1202  266D- A0 7C              LDY =124
1203  266F- B1 08              LDA (SP),Y
1204  2671- 85 DD              STA TRACK
1205  2673- A5 08              LDA SP
1206  2675- 38                 SEC
1207  2676- E9 04              SBC =4
1208  2678- 20 F0 20           JSR DECS2+5
1209  267B- 20 DC 22           JSR GETS2
1210  267E- 4C 88 20           JMP PREPDO
1211                   *
1212                   * P-CODE 39: NBYT       LOAD N BYTES IMMEDIATELY
1213                   *****************
1214                   *
1215  2681- 20 9D 24   NBYT    JSR FETCH
1216  2684- AA                 TAX             BYTE COUNTER
1217  2685- 20 AF 22   NBYT1   JSR COPY
1218  2688- 20 9D 24           JSR FETCH
1219  268B- 84 01              STY ACCU+1      Y=0
1220  268D- 85 00              STA ACCU
1221  268F- CA                 DEX
1222  2690- D0 F3              BNE NBYT1
1223  2692- 60                 RTS
1224                   *
1225                   * P-CODE 3A: NWRD       LOAD N WORD IMMEDIATELY
1226                   *****************
1227                   *
1228  2693- 20 9D 24   NWRD    JSR FETCH
1229  2696- AA                 TAX             WORD COUNTER
1230  2697- 20 AF 22   NWRD1   JSR COPY
1231  269A- 20 9D 24           JSR FETCH
1232  269D- 85 00              STA ACCU
1233  269F- 20 9D 24           JSR FETCH
1234  26A2- 85 01              STA ACCU+1
1235  26A4- CA                 DEX
1236  26A5- D0 F0              BNE NWRD1
1237  26A7- 60                 RTS
1238                   *
1239                   * P-CODE 3B: LODN       LOAD N MORE WORDS
1240                   *****************
1241                   *
1242  26A8- 20 9D 24   LODN    JSR FETCH
1243  26AB- AA                 TAX

----------------------------------------------------------------------

R65 PASCAL RUNTIME                 24/02/19   R65 ASSEMBLER  PAGE 26

1244  26AC- 20 AF 22   LODN1   JSR COPY
1245  26AF- A5 19              LDA ABASE
1246  26B1- 18                 CLC
1247  26B2- 69 02              ADC =2
1248  26B4- 85 19              STA ABASE
1249  26B6- 90 02              BCC *+4
1250  26B8- E6 1A              INC ABASE+1
1251  26BA- 20 09 25           JSR LOAD2
1252  26BD- CA                 DEX
1253  26BE- D0 EC              BNE LODN1
1254  26C0- 60                 RTS
1255                   *
1256                   * P-CODE 3C: STON       STORE N MORE WORDS
1257                   *****************
1258                   *
1259  26C1- 20 9D 24   STON    JSR FETCH
1260  26C4- AA                 TAX
1261  26C5- A5 19      STON1   LDA ABASE
1262  26C7- 38                 SEC
1263  26C8- E9 02              SBC =2
1264  26CA- 85 19              STA ABASE
1265  26CC- B0 02              BCS *+4
1266  26CE- C6 1A              DEC ABASE+1
1267  26D0- 20 6E 25           JSR STOR2
1268  26D3- CA                 DEX
1269  26D4- D0 EF              BNE STON1
1270  26D6- 60                 RTS
1271                   *
1272                   * P-CODE 3D: LODI       LOAD INDIRECT
1273                   *****************
1274                   *
1275  26D7- 20 DD 26   LODI    JSR GETACC
1276  26DA- 4C 09 25           JMP LOAD2
1277                   *
1278  26DD- A5 00      GETACC  LDA ACCU
1279  26DF- A6 01              LDX ACCU+1
1280  26E1- 38                 SEC
1281  26E2- E9 80              SBC =128
1282  26E4- B0 01              BCS *+3
1283  26E6- CA                 DEX
1284  26E7- 85 19              STA ABASE
1285  26E9- 86 1A              STX ABASE+1
1286  26EB- 60                 RTS
1287                   *
1288                   * P-CODE 3E: STOI       STORE INDIRECT
1289                   *****************
1290                   *
1291  26EC- 20 DD 26   STOI    JSR GETACC
1292  26EF- 20 DC 22           JSR GETS2
1293  26F2- 4C 6E 25           JMP STOR2

----------------------------------------------------------------------

R65 PASCAL RUNTIME                 24/02/19   R65 ASSEMBLER  PAGE 27

1294                   *
1295                   * P-CODE 3F: EXST       EXCHANGE STACK
1296                   *****************
1297                   *
1298  26F5- A0 7E      EXST    LDY =126
1299  26F7- B1 08              LDA (SP),Y
1300  26F9- AA                 TAX
1301  26FA- A5 00              LDA ACCU
1302  26FC- 91 08              STA (SP),Y
1303  26FE- 86 00             STX ACCU
1304  2700- C8                 INY
1305  2701- B1 08              LDA (SP),Y
1306  2703- AA                 TAX
1307  2704- A5 01              LDA ACCU+1
1308  2706- 91 08              STA (SP),Y
1309  2708- 86 01              STX ACCU+1
1310  270A- 60                 RTS
1311                   *
1312                   * P-CODE 40 TIND        TEST INDEX
1313                   ****************
1314                   *
1315  270B- 20 9D 24   TIND    JSR FETCH       LOWLIM-1
1316  270E- AA                 TAX
1317  270F- 20 9D 24           JSR FETCH
1318  2712- E4 00              CPX ACCU
1319  2714- E5 01              SBC ACCU+1
1320  2716- 70 0E              BVS TINDERR
1321                   *
1322  2718- 20 9D 24           JSR FETCH       HIGHLIM
1323  271B- AA                 TAX
1324  271C- 20 9D 24           JSR FETCH
1325  271F- E4 00              CPX ACCU
1326  2721- E5 01              SBC ACCU+1
1327  2723- 90 01              BCC TINDERR
1328  2725- 60                 RTS
1329                   *
1330  2726- A2 83      TINDERR LDX =$83        RUNTIME ERROR
1331  2728- 4C E1 28           JMP PERROR      INDEX OUT OF BOUNDS
1332                   *
1333                   * P-CODE 41: RUNP       RUN PROGRAM
1334                   *****************
1335                   *
1336  272B- A0 82      RUNP    LDY =130
1337  272D- A5 00              LDA ACCU        SAVE ACCU
1338  272F- A6 01              LDX ACCU+1
1339  2731- 20 5D 27           JSR SAVE
1340  2734- A5 17              LDA BASE        SAVE BASE
1341  2736- A6 18              LDX BASE+1
1342  2738- 20 5D 27           JSR SAVE
1343  273B- A5 0A              LDA PC          SAVE PC

----------------------------------------------------------------------

R65 PASCAL RUNTIME                 24/02/19   R65 ASSEMBLER  PAGE 28

1344  273D- A6 0B              LDX PC+1
1345  273F- 20 5D 27           JSR SAVE
1346  2742- A5 11              LDA STPROG      SAVE STPROG
1347  2744- A6 12              LDX STPROG+1
1348  2746- 20 5D 27           JSR SAVE
1349  2749- A5 13              LDA EOPROG      SAVE EOPROG
1350  274B- A6 14              LDX EOPROG+1
1351  274D- 20 5D 27           JSR SAVE
1352  2750- A5 08              LDA SP          GET SP
1353  2752- A6 09              LDX SP+1
1354  2754- 18                 CLC
1355  2755- 69 8C              ADC =140
1356  2757- 90 01              BCC *+3
1357  2759- E8                 INX             COMPUTE NEW STPROG
1358  275A- 4C 60 29           JMP EXEC3
1359                   *
1360                   *
1361  275D- 91 08      SAVE    STA (SP),Y
1362  275F- C8                 INY
1363  2760- 8A                 TXA
1364  2761- 91 08              STA (SP),Y
1365  2763- C8                 INY
1366  2764- 60                 RTS
1367                   *
1368                   *
1369  2765- 88         GETBACK DEY
1370  2766- B1 08              LDA (SP),Y
1371  2768- AA                 TAX
1372  2769- 88                 DEY
1373  276A- B1 08              LDA (SP),Y
1374  276C- 60                 RTS
1375                   *
1376                   *
1377                   * P-CODE 42: ADDF
1378                   *****************
1379                   *
1380  276D- 20 8A 27   ADDF    JSR GETFLP2
1381  2770- 20 0E 2B           JSR FADD
1382                   *
1383  2773- A5 08      PUTFLP0 LDA SP          DECREMENT SP BY 4
1384  2775- 38                 SEC
1385  2776- E9 04              SBC =4
1386  2778- 85 08              STA SP
1387  277A- B0 02              BCS PUTFLP
1388  277C- C6 09              DEC SP+1
1389  277E- A5 02      PUTFLP  LDA M1+1        AND SAVE HALF OF NUMBER
1390  2780- A0 7E              LDY =126
1391  2782- 91 08              STA (SP),Y
1392  2784- C8                 INY
1393  2785- A5 03              LDA M1+2

----------------------------------------------------------------------

R65 PASCAL RUNTIME                 24/02/19   R65 ASSEMBLER  PAGE 29

1394  2787- 91 08              STA (SP),Y
1395  2789- 60                 RTS
1396                   *
1397  278A- A0 7A      GETFLP2 LDY =122        GET SECOND NUMBER
1398  278C- B1 08              LDA (SP),Y
1399  278E- 85 1D              STA M2+1
1400  2790- C8                 INY
1401  2791- B1 08              LDA (SP),Y
1402  2793- 85 1E              STA M2+2
1403  2795- C8                 INY
1404  2796- B1 08              LDA (SP),Y
1405  2798- 85 1B              STA X2
1406  279A- C8                 INY
1407  279B- B1 08              LDA (SP),Y
1408  279D- 85 1C              STA M2
1409  279F- A0 7E      GETFLP  LDY =126        AND HALF OF FIRST
1410  27A1- B1 08              LDA (SP),Y
1411  27A3- 85 02              STA M1+1
1412  27A5- C8                 INY
1413  27A6- B1 08              LDA (SP),Y
1414  27A8- 85 03              STA M1+2
1415  27AA- 60                 RTS
1416                   *
1417                   * P-CODE 43: SUBF
1418                   *****************
1419                   *
1420  27AB- 20 8A 27   SUBF    JSR GETFLP2
1421  27AE- 20 08 2B           JSR FSUB
1422  27B1- 4C 73 27           JMP PUTFLP0
1423                   *
1424                   * P-CODE 44: MULF
1425                   *****************
1426                   *
1427  27B4- 20 8A 27   MULF    JSR GETFLP2
1428  27B7- 20 35 2B           JSR FMUL
1429  27BA- 4C 73 27           JMP PUTFLP0
1430                   *
1431                   * P-CODE 45: DIVF
1432                   *****************
1433                   *
1434  27BD- 20 8A 27   DIVF    JSR GETFLP2
1435  27C0- 20 5B 2B           JSR FDIV
1436  27C3- 4C 73 27           JMP PUTFLP0
1437                   *
1438                   * P-CODE 46: FLOF
1439                   *****************
1440                   *
1441  27C6- A5 00      FLOF    LDA ACCU
1442  27C8- 85 02              STA M1+1        HIGH BYTE IS IN ACCU
1443                   *                       SAME AS M1

----------------------------------------------------------------------

R65 PASCAL RUNTIME                 24/02/19   R65 ASSEMBLER  PAGE 30

1444  27CA- 20 EA 2A           JSR FLOAT
1445  27CD- 20 BE 22           JSR INCS2
1446  27D0- 4C 7E 27           JMP PUTFLP
1447                   *
1448                   * P-CODE 47: FIXF
1449                   *****************
1450                   *
1451  27D3- 20 9F 27   FIXF    JSR GETFLP
1452  27D6- 20 A8 2B           JSR FIX
1453  27D9- A5 02              LDA M1+1
1454  27DB- 85 00              STA ACCU
1455  27DD- 4C EB 20           JMP DECS2
1456                   *
1457                   * P-CODE 48: FEQU       =
1458                   *****************
1459                   *
1460  27E0- 20 01 28   FEQU    JSR TESTF
1461  27E3- F0 12              BEQ TRUE
1462                   *
1463  27E5- A2 00      FALSE   LDX =0
1464  27E7- 86 00              STX ACCU
1465  27E9- 86 01              STX ACCU+1
1466  27EB- A5 08      DECS6   LDA SP
1467  27ED- 38                 SEC
1468  27EE- E9 06              SBC =6
1469  27F0- 85 08              STA SP
1470  27F2- B0 02              BCS *+4
1471  27F4- C6 09              DEC SP+1
1472  27F6- 60                 RTS
1473                   *
1474  27F7- A2 01      TRUE    LDX =1
1475  27F9- 86 00              STX ACCU
1476  27FB- CA                 DEX
1477  27FC- 86 01              STX ACCU+1
1478  27FE- 4C EB 27          JMP DECS6
1479                   *
1480  2801- 20 8A 27   TESTF   JSR GETFLP2
1481  2804- 20 08 2B           JSR FSUB
1482  2807- A5 01              LDA M1
1483  2809- 60                 RTS
1484                   *
1485                   * P-CODE 49: FNEQ       <>
1486                   *****************
1487                   *
1488  280A- 20 01 28   FNEQ    JSR TESTF
1489  280D- D0 E8              BNE TRUE
1490  280F- F0 D4              BEQ FALSE
1491                   *
1492                   * P-CODE 4A: FLES       <
1493                   *****************

----------------------------------------------------------------------

R65 PASCAL RUNTIME                 24/02/19   R65 ASSEMBLER  PAGE 31

1494                   *
1495  2811- 20 01 28   FLES    JSR TESTF
1496  2814- 10 CF              BPL FALSE
1497  2816- 30 DF              BMI TRUE
1498                   *
1499                   * P-CODE 4B: FGRE       >=
1500                   *****************
1501                   *
1502  2818- 20 01 28   FGRE    JSR TESTF
1503  281B- 10 DA              BPL TRUE
1504  281D- 30 C6              BMI FALSE
1505                   *
1506                   * P-CODE 4C: FGRT       >
1507                   *****************
1508                   *
1509  281F- 20 01 28   FGRT    JSR TESTF
1510  2822- 30 C1              BMI FALSE
1511  2824- F0 BF              BEQ FALSE
1512  2826- 10 CF              BPL TRUE
1513                   *
1514                   * P-CODE 4D: FLEE       <=
1515                   *****************
1516                   *
1517  2828- 20 01 28   FLEE    JSR TESTF
1518  282B- 30 CA              BMI TRUE
1519  282D- F0 C8              BEQ TRUE
1520  282F- 10 B4              BPL FALSE
1521                   *
1522                   * P-CODE 4E: FCOM       COMPLEMENT
1523                   *****************
1524                   *
1525  2831- 20 9F 27   FCOM    JSR GETFLP
1526  2834- 20 4D 2B           JSR FCOMPL
1527  2837- 4C 7E 27           JMP PUTFLP
1528                   *
1529                   *
1530                   * P-CODE 4F: TFER       TEST FILE ERROR
1531                   *****************
1532                   *
1533  283A- A6 23      TFER    LDX IOCHECK
1534  283C- F0 04              BEQ TFER1
1535  283E- A6 DB              LDX FILERR
1536  2840- D0 01              BNE TFER2
1537  2842- 60         TFER1   RTS             OK
1538                   *
1539  2843- 4C E1 28   TFER2   JMP PERROR
1540                   *
1541                   * P-CODE 50: OPRA       OPEN RA-FILE
1542                   *****************
1543                   *

----------------------------------------------------------------------

R65 PASCAL RUNTIME                 24/02/19   R65 ASSEMBLER  PAGE 32

1544  2846- 20 AF 22   OPRA    JSR COPY        SAVE ACCU
1545  2849- 20 AF 2B           JSR OPENRA      OPEN FILE
1546  284C- C8                 INY
1547  284D- C8                 INY
1548  284E- 84 00              STY ACCU        SAVE FILE NO
1549  2850- A9 00              LDA =0
1550  2852- 85 01              STA ACCU+1
1551  2854- 60                 RTS
1552                   *
1553                   * P-CODE 51: GETR       GET FROM RA FILE
1554                   *****************
1555                   *
1556                   * NO AUTOMATIC ERROR CHECKING
1557                   *
1558  2855- 20 62 28   GETR    JSR GETR1
1559  2858- 20 B6 2C           JSR GETBYTE
1560  285B- 85 00              STA ACCU
1561  285D- A9 00              LDA =0
1562  285F- 85 01              STA ACCU+1
1563  2861- 60                 RTS
1564                   *
1565  2862- 20 EB 20   GETR1   JSR DECS2
1566  2865- A0 80              LDY =128
1567  2867- B1 08              LDA (SP),Y      GET FILE NO
1568  2869- AA                 TAX
1569  286A- CA                 DEX
1570  286B- CA                 DEX
1571  286C- A5 00              LDA ACCU        GET POINTER
1572  286E- A4 01              LDY ACCU+1
1573  2870- 60                 RTS
1574                   *
1575                   * P-CODE 52: PUTR       PUT TO RA=FILE
1576                   *****************
1577                   *
1578                   * NO AUTOMATIC ERROR CHECLING
1579                   *
1580  2871- A5 00      PUTR    LDA ACCU
1581  2873- 85 FE              STA KCHAR
1582  2875- 20 EB 20           JSR DECS2
1583  2878- 20 62 28           JSR GETR1
1584  287B- 20 D4 2C           JSR PUTBYTE
1585  287E- 4C DC 22           JMP GETS2
1586                   *
1587                   * P-CODE 53: SWA2       SWAP 2 AND 3 ON STACK
1588                   *****************
1589                   *
1590  2881- A0 7E      SWA2    LDY =126
1591  2883- 20 88 28           JSR SWA3
1592  2886- A0 7F              LDY =127
1593                   *

----------------------------------------------------------------------

R65 PASCAL RUNTIME                 24/02/19   R65 ASSEMBLER  PAGE 33

1594  2888- B1 08      SWA3    LDA (SP),Y
1595  288A- AA                 TAX
1596  288B- 88                 DEY
1597  288C- 88                 DEY
1598  288D- B1 08              LDA (SP),Y
1599  288F- C8                 INY
1600  2890- C8                 INY
1601  2891- 91 08              STA (SP),Y
1602  2893- 8A                 TXA
1603  2894- 88                 DEY
1604  2895- 88                 DEY
1605  2896- 91 08              STA (SP),Y
1606  2898- 60                 RTS
1607                   *
1608                   * GETCHR0: GET A CHAR FROM SPECIFIED FILE
1609                   *****************************************
1610                   *
1611  2899- A6 0D      GETCHR0 LDX DEVICE
1612  289B- D0 1A              BNE GETCHR4
1613                   *
1614  289D- A6 15      GETCHR1 LDX BUFFPN
1615  289F- 10 06              BPL GETCHR2
1616  28A1- 20 09 23           JSR RLIN
1617  28A4- 4C 9D 28           JMP GETCHR1
1618                   *
1619  28A7- E4 16      GETCHR2 CPX ENDBUF      IS IS END OF BUFFER?
1620  28A9- D0 07              BNE GETCHR3
1621  28AB- A9 FF              LDA =$FF
1622  28AD- 85 15              STA BUFFPN
1623  28AF- A9 0D              LDA =$D
1624  28B1- 60                 RTS
1625                   *
1626  28B2- E6 15      GETCHR3 INC BUFFPN
1627  28B4- B5 24              LDA LINBUF,X
1628  28B6- 60                 RTS
1629                   *
1630  28B7- CA         GETCHR4 DEX
1631  28B8- D0 03              BNE GETCHR5     SKIP, IF NOT KEY
1632  28BA- 4C 00 E0           JMP GETKEY
1633                   *
1634  28BD- CA         GETCHR5 DEX
1635  28BE- A9 00              LDA =0
1636  28C0- 85 DA              STA FILFLG
1637  28C2- 20 18 F0           JSR READCH
1638  28C5- 4C 3A 28           JMP TFER
1639                   *
1640  28C8- 60         GETCHR6 RTS
1641                   *
1642                   * PRTCHR0: PRINT CHAR TO SPECIFIED FILE
1643                   ***************************************

----------------------------------------------------------------------

R65 PASCAL RUNTIME                 24/02/19   R65 ASSEMBLER  PAGE 34

1644                   *
1645  28C9- A6 0D      PRTCHR0 LDX DEVICE
1646  28CB- D0 03              BNE PRTCHR1
1647  28CD- 4C 09 E0           JMP PRTCHR
1648                   *
1649  28D0- CA         PRTCHR1 DEX
1650  28D1- D0 03              BNE PRTCHR2
1651  28D3- 4C 0C E0           JMP AUTOPR
1652                   *
1653  28D6- CA         PRTCHR2 DEX
1654  28D7- A0 00              LDY =0
1655  28D9- 84 DA              STY FILFLG
1656  28DB- 20 1B F0           JSR WRITCH
1657  28DE- 4C 3A 28           JMP TFER
1658                   *
1659                   *
1660                   * PERROR: PASCAL RUNTIME ERROR
1661                   ******************************
1662                   *
1663  28E1- 20 27 E0   PERROR  JSR PRTINF
1664  28E4- 0D 0A 07           BYT $D,$A,7,'Pascal error '+128
1664  28E7- 50 61 73 
1664  28EA- 63 61 6C 
1664  28ED- 20 65 72 
1664  28F0- 72 6F 72 
1664  28F3- A0 
1665  28F4- A9 00              LDA =0
1666  28F6- 85 0D              STA DEVICE
1667  28F8- 8A                 TXA
1668  28F9- 85 0C              STA RUNERR
1669  28FB- 20 2D E0           JSR PRTBYT
1670  28FE- A5 0A             LDA PC
1671  2900- 38                 SEC
1672  2901- E5 11              SBC STPROG
1673  2903- 85 00              STA ACCU
1674  2905- A5 0B              LDA PC+1
1675  2907- E5 12              SBC STPROG+1
1676  2909- 85 01              STA ACCU+1
1677  290B- F0 0C              BEQ PERROR1
1678  290D- 30 0A              BMI PERROR1
1679  290F- 20 27 E0           JSR PRTINF
1680  2912- 20 61 74           BYT ' at '+128
1680  2915- A0 
1681  2916- 20 AA 23           JSR PRTN
1682                   *
1683  2919- 4C 10 20   PERROR1 JMP STOP
1684                   *
1685                   *
1686                   * WARM START ENTRY POINT
1687                   ************************

----------------------------------------------------------------------

R65 PASCAL RUNTIME                 24/02/19   R65 ASSEMBLER  PAGE 35

1688                   *
1689  291C- AD 81 17   WARMST  LDA SFLAG       SET PASCAL RUNTIME BIT
1690  291F- 09 01              ORA =$01        IN SFLAG
1691  2921- 8D 81 17           STA SFLAG
1692  2924- A2 00              LDX =0
1693  2926- 86 0B              STX PC+1
1694  2928- 86 0D              STX DEVICE
1695  292A- CA                 DEX
1696  292B- 86 16              STX ENDBUF
1697  292D- 86 23              STX IOCHECK
1698  292F- A2 00              LDX =0
1699                   *
1700  2931- A0 00      EXEC    LDY =0
1701  2933- 84 0B              STY PC+1
1702  2935- BD ED 29           LDA EXTABLE,X
1703  2938- 9D 20 03           STA FILNM1,X
1704  293B- E8                 INX
1705  293C- C8                 INY
1706  293D- C0 10              CPY =16
1707  293F- 90 F2              BCC EXEC+2
1708  2941- A9 00              LDA =0
1709  2943- 8D 30 03           STA FILCY1
1710                   *           LDA =1     LOAD SYSTEM:R     FROM
1711                   *           STA FILDRV SAME DRIVE AS PASCAL
1712                   *
1713  2946- A9 00      EXECUTE LDA =0
1714  2948- 85 DA              STA FILFLG
1715  294A- AD 0B 20           LDA USEREND
1716  294D- AE 0C 20           LDX USEREND+1
1717  2950- 38                 SEC
1718  2951- E9 90              SBC =144
1719  2953- B0 01              BCS *+3
1720  2955- CA                 DEX
1721  2956- 85 0E              STA ENDSTK
1722  2958- 86 0F              STX ENDSTK+1
1723                   *
1724  295A- AD 09 20   EXEC1   LDA USERST
1725  295D- AE 0A 20           LDX USERST+1
1726  2960- 85 11      EXEC3   STA STPROG
1727  2962- 86 12              STX STPROG+1
1728  2964- 8D 31 03           STA FILSA1
1729  2967- 8E 32 03           STX FILSA1+1
1730  296A- 20 15 E8           JSR RDFILE      READ FILE TO EXECUTE
1731  296D- F0 04              BEQ EXEC2
1732  296F- AA                 TAX             PASCAL RUNTIME ERROR
1733  2970- 4C E1 28           JMP PERROR
1734                   *
1735  2973- 20 27 E0   EXEC2   JSR PRTINF
1736  2976- 0D 8A              BYT $D,$8A
1737  2978- AD 12 03           LDA FILSTP

----------------------------------------------------------------------

R65 PASCAL RUNTIME                 24/02/19   R65 ASSEMBLER  PAGE 36

1738  297B- C9 52              CMP ='R'        MUST BE PASCAL
1739  297D- F0 05              BEQ RUN           RUNTIME CODE
1740  297F- A2 84              LDX =$84        PASCAL RUNTIME ERROR
1741  2981- 4C E1 28           JMP PERROR      WRONG FILEtYPE
1742                   *
1743  2984- A0 00      RUN     LDY =0          READ END ADDRESS
1744  2986- B1 11              LDA (STPROG),Y  FROM FILE
1745  2988- 18                 CLC
1746  2989- 65 11              ADC STPROG
1747  298B- 85 13              STA EOPROG
1748  298D- C8                 INY
1749  298E- B1 11              LDA (STPROG),Y
1750  2990- 65 12              ADC STPROG+1
1751  2992- 85 14              STA EOPROG+1
1752  2994- A5 13              LDA EOPROG      GET END OF STACK
1753  2996- A6 14              LDX EOPROG+1
1754  2998- 38                 SEC
1755  2999- E9 80              SBC =128
1756  299B- 85 17              STA BASE
1757  299D- 85 08              STA SP
1758  299F- B0 01              BCS *+3
1759  29A1- CA                 DEX
1760  29A2- 86 18              STX BASE+1
1761  29A4- 86 09              STX SP+1
1762                   *
1763  29A6- A5 11              LDA STPROG
1764  29A8- A6 12              LDX STPROG+1
1765  29AA- 18                 CLC
1766  29AB- 69 02              ADC =2
1767  29AD- 85 0A              STA PC
1768  29AF- 90 01              BCC *+3
1769  29B1- E8                 INX
1770  29B2- 86 0B              STX PC+1
1771  29B4- A9 00              LDA =0
1772  29B6- 85 0C              STA RUNERR
1773  29B8- 20 C3 29   LOOP    JSR EXCODE
1774  29BB- AD 81 17           LDA SFLAG
1775  29BE- 30 20              BMI ESCERR
1776  29C0- 4C B8 29           JMP LOOP
1777                   *
1778                   *
1779  29C3- 20 9D 24   EXCODE  JSR FETCH
1780  29C6- 89 F1              STA =$F1
1781  29C8- C9 54              CMP =$54        TEST CODENUMBER
1782  29CA- 90 05              BCC *+7
1783  29CC- A9 85      ILLC    LDA =$85        PASCAL RUNTIME ERROR
1784  29CE- 4C E1 28           JMP PERROR      ILLEGAL P-CODE
1785                   *
1786  29D1- 0A                 ASL A
1787  29D2- AA                 TAX

----------------------------------------------------------------------

R65 PASCAL RUNTIME                 24/02/19   R65 ASSEMBLER  PAGE 37

1788  29D3- BD FD 29           LDA TABLE,X
1789  29D6- 85 1B              STA ARG1
1790  29D8- BD FE 29           LDA TABLE+1,X
1791  29DB- 85 1C              STA ARG1+1
1792  29DD- 6C 1B 00           JMP (ARG1)
1793                   *
1794  29E0- AD 81 17   ESCERR  LDA SFLAG       CLEAR ESCAPE FLAG
1795  29E3- 29 7F              AND =$7F
1796  29E5- 8D 81 17           STA SFLAG
1797  29E8- A2 86              LDX =$86        PASCAL RUNTIME ERROR
1798  29EA- 4C E1 28           JMP PERROR      ESCAPE DURING EXECUTION
1799                   *
1800  29ED- 53 59 53   EXTABLE BYT 'SYSTEM:R        '
1800  29F0- 54 45 4D 
1800  29F3- 3A 52 20 
1800  29F6- 20 20 20 
1800  29F9- 20 20 20 
1800  29FC- 20 
1801                   *
1802  29FD- 10 20 9A  TABLE   WRD STOP,RETN,NEGA,ADDA,SUBA,MULA
1802  2A00- 20 CD 20 
1802  2A03- DB 20 F7 
1802  2A06- 20 0A 21 
1803  2A09- 6F 21 E1           WRD DIVA,LOWB,TEQU,TNEQ,TLES,TGRE
1803  2A0C- 21 EC 21 
1803  2A0F- FD 21 07 
1803  2A12- 22 11 22 
1804  2A15- 17 22 1D           WRD TGRT,TLEE,ORAC,ANDA,EORA,NOTA
1804  2A18- 22 23 22 
1804  2A1B- 35 22 47 
1804  2A1E- 22 59 22 
1805  2A21- 69 22 82           WRD LEFT,RIGH,INCA,DECA,COPY,PEEK
1805  2A24- 22 9F 22 
1805  2A27- A6 22 AF 
1805  2A2A- 22 EA 22 
1806  2A2D- F3 22 00           WRD POKE,CALA,RLIN,GETC,GETN,PRTC
1806  2A30- 23 09 23 
1806  2A33- 38 23 45 
1806  2A36- 23 A2 23 
1807  2A39- AA 23 1D           WRD PRTN,PRTS,LITB,INCB,LITW,INCW
1807  2A3C- 24 53 24 
1807  2A3F- 60 24 8F 
1807  2A42- 24 A8 24 
1808  2A45- C5 24 D7           WRD JUMP,JMPZ,JMPO,LOAD,LODX,STOR
1808  2A48- 24 EC 24 
1808  2A4B- F5 24 43 
1808  2A4E- 25 5D 25 
1809  2A51- 7C 25 A2           WRD STOX,CALL,SDEV,RDEV,FNAM,OPNR
1809  2A54- 25 D8 25 
1809  2A57- DF 25 E4 

----------------------------------------------------------------------

R65 PASCAL RUNTIME                 24/02/19   R65 ASSEMBLER  PAGE 38

1809  2A5A- 25 01 26 
1810  2A5D- 12 26 17           WRD OPNW,CLOS,PRTI,GHGH,GLOW,PHGH
1810  2A60- 26 21 26 
1810  2A63- 2E 26 32 
1810  2A66- 26 37 26 
1811  2A69- 40 26 49           WRD PLOW,GSEC,PSEC,NBYT,NWRD,LODN
1811  2A6C- 26 52 26 
1811  2A6F- 81 26 93 
1811  2A72- 26 A8 26 
1812  2A75- C1 26 D7           WRD STON,LODI,STOI,EXST,TIND,RUNP
1812  2A78- 26 EC 26 
1812  2A7B- F5 26 0B 
1812  2A7E- 27 2B 27 
1813  2A81- 6D 27 AB           WRD ADDF,SUBF,MULF,DIVF,FLOF,FIXF
1813  2A84- 27 B4 27 
1813  2A87- BD 27 C6 
1813  2A8A- 27 D3 27 
1814  2A8D- E0 27 0A           WRD FEQU,FNEQ,FLES,FGRE,FGRT,FLEE
1814  2A90- 28 11 28 
1814  2A93- 18 28 1F 
1814  2A96- 28 28 28 
1815  2A99- 31 28 3A           WRD FCOM,TFER,OPRA,GETR,PUTR,SWA2
1815  2A9C- 28 46 28 
1815  2A9F- 55 28 71 
1815  2AA2- 28 81 28 
1816                   *
1817                   * COLDSTART
1818                   ***********
1819                   *
1820  2AA5- 58         COLDST  CLI
1821  2AA6- D8                 CLD
1822  2AA7- AD 09 20           LDA USERST
1823  2AAA- AE 0A 20           LDX USERST+1
1824  2AAD- 85 11              STA STPROG
1825  2AAF- 86 12              STX STPROG+1
1826  2AB1- A0 00              LDY =0
1827  2AB3- 98                 TYA
1828  2AB4- 91 11              STA (STPROG),Y
1829  2AB6- C8                 INY
1830  2AB7- C0 04              CPY =4
1831  2AB9- 90 F9              BCC *-5
1832  2ABB- 4C 1C 29           JMP WARMST
1833                   *
1834                           TIT R65 PASCAL: FLP-MATH
1835                           PAG

----------------------------------------------------------------------

R65 PASCAL: FLP-MATH               24/02/19   R65 ASSEMBLER  PAGE 39

1836                   *
1837                   ********************************
1838                   * R65 PASCAL FLP MATH ROUTINES *
1839                   ********************************
1840                   *
1841                   *
1842  2ABE- 18         ADD     CLC
1843  2ABF- A2 02              LDX =2
1844  2AC1- B5 01      ADD1    LDA M1,X
1845  2AC3- 75 1C              ADC M2,X
1846  2AC5- 95 01              STA M1,X
1847  2AC7- CA                 DEX
1848  2AC8- 10 F7              BPL ADD1
1849  2ACA- 60                 RTS
1850                   *
1851  2ACB- 06 10      MD1     ASL SIGN
1852  2ACD- 20 D0 2A           JSR ABSWAP
1853  2AD0- 24 01      ABSWAP  BIT M1
1854  2AD2- 10 05              BPL ABSWP1
1855  2AD4- 20 4D 2B           JSR FCOMPL
1856  2AD7- E6 10              INC SIGN
1857  2AD9- 38         ABSWP1  SEC
1858                   *
1859                   * SWAP: EXCHANGE F1 AND F2
1860                   **************************
1861                   *
1862  2ADA- A2 04      SWAP    LDX =4
1863  2ADC- 94 03      SWAP1   STY E-1,X
1864  2ADE- B5 FF              LDA <(X1-1),X
1865  2AE0- B4 1A              LDY X2-1,X
1866  2AE2- 94 FF              STY <(X1-1),X
1867  2AE4- 95 1A              STA X2-1,X
1868  2AE6- CA                 DEX
1869  2AE7- D0 F3              BNE SWAP1
1870  2AE9- 60                 RTS
1871                   *
1872                   * FLOAT: FLOAT M1,M1+1 TO RESULT IN F1
1873                   **************************************
1874                   *
1875  2AEA- A9 8E      FLOAT   LDA =$8E
1876  2AEC- 85 00              STA X1
1877  2AEE- A9 00              LDA =0
1878  2AF0- 85 03              STA M1+2
1879  2AF2- F0 08              BEQ NORM
1880  2AF4- C6 00      NORM1   DEC X1
1881  2AF6- 06 03              ASL M1+2
1882  2AF8- 26 02              ROL M1+1
1883  2AFA- 26 01              ROL M1
1884  2AFC- A5 01      NORM    LDA M1
1885  2AFE- 0A                 ASL A

----------------------------------------------------------------------

R65 PASCAL: FLP-MATH               24/02/19   R65 ASSEMBLER  PAGE 40

1886  2AFF- 45 01             EOR M1
1887  2B01- 30 04              BMI RTS1
1888  2B03- A5 00              LDA X1
1889  2B05- D0 ED              BNE NORM1
1890  2B07- 60         RTS1    RTS
1891                   *
1892                   * FSUB: F1=F2-F1
1893                   ****************
1894                   *
1895  2B08- 20 4D 2B   FSUB    JSR FCOMPL
1896  2B0B- 20 1B 2B   SWPALG  JSR ALGNSW
1897                   *
1898                   * FADD: F1=F2+F1
1899                   ****************
1900                   *
1901  2B0E- A5 1B      FADD    LDA X2
1902  2B10- C5 00              CMP X1
1903  2B12- D0 F7              BNE SWPALG
1904  2B14- 20 BE 2A           JSR ADD
1905  2B17- 50 E3      ADDEND  BVC NORM
1906  2B19- 70 05              BVS RTLOG
1907  2B1B- 90 BD      ALGNSW  BCC SWAP
1908  2B1D- A5 01      RTAR    LDA M1
1909  2B1F- 0A                 ASL A
1910  2B20- E6 00      RTLOG   INC X1
1911  2B22- F0 7E              BEQ OVFL
1912  2B24- A2 FA      RTLOG1  LDX =$FA
1913  2B26- A9 80      ROR1    LDA =$80
1914  2B28- B0 01              BCS ROR2
1915  2B2A- 0A                 ASL A
1916  2B2B- 56 07      ROR2    LSR E+3,X
1917  2B2D- 15 07              ORA E+3,X
1918  2B2F- 95 07              STA E+3,X
1919  2B31- E8                 INX
1920  2B32- D0 F2              BNE ROR1
1921  2B34- 60                 RTS
1922                   *
1923                   * FMUL: F1=F2*F1
1924                   ****************
1925                   *
1926  2B35- 20 CB 2A   FMUL    JSR MD1
1927  2B38- 65 00              ADC X1
1928  2B3A- 20 8B 2B           JSR MD2
1929  2B3D- 18                 CLC
1930  2B3E- 20 24 2B   MUL1    JSR RTLOG1
1931  2B41- 90 03              BCC MUL2
1932  2B43- 20 BE 2A           JSR ADD
1933  2B46- 88         MUL2    DEY
1934  2B47- 10 F5              BPL MUL1
1935  2B49- 46 10      MDEND   LSR SIGN

----------------------------------------------------------------------

R65 PASCAL: FLP-MATH               24/02/19   R65 ASSEMBLER  PAGE 41

1936  2B4B- 90 AF      NORMX   BCC NORM
1937  2B4D- 38         FCOMPL  SEC
1938  2B4E- A2 03              LDX =3
1939  2B50- A9 00      COMPL1  LDA =0
1940  2B52- F5 00              SBC X1,X
1941  2B54- 95 00              STA X1,X
1942  2B56- CA                 DEX
1943  2B57- D0 F7              BNE COMPL1
1944  2B59- F0 BC              BEQ ADDEND
1945                   *
1946                   * FDIV: F1=F2/F1
1947                   ****************
1948                   *
1949  2B5B- 20 CB 2A   FDIV    JSR MD1
1950  2B5E- E5 00              SBC X1
1951  2B60- 20 8B 2B           JSR MD2
1952  2B63- 38         FDIV1   SEC
1953  2B64- A2 02              LDX =2
1954  2B66- B5 1C      FDIV2   LDA M2,X
1955  2B68- F5 04              SBC E,X
1956  2B6A- 48                 PHA
1957  2B6B- CA                 DEX
1958  2B6C- 10 F8              BPL FDIV2
1959  2B6E- A2 FD              LDX =$FD
1960  2B70- 68         FDIV3   PLA
1961  2B71- 90 02              BCC FDIV4
1962  2B73- 95 1F              STA M2+3,X
1963  2B75- E8         FDIV4   INX
1964  2B76- D0 F8              BNE FDIV3
1965  2B78- 26 03              ROL M1+2
1966  2B7A- 26 02              ROL M1+1
1967  2B7C- 26 01              ROL M1
1968  2B7E- 06 1E              ASL M2+2
1969  2B80- 26 1D              ROL M2+1
1970  2B82- 26 1C              ROL M2
1971  2B84- B0 1C              BCS OVFL
1972  2B86- 88                 DEY
1973  2B87- D0 DA              BNE FDIV1
1974  2B89- F0 BE              BEQ MDEND
1975  2B8B- 86 03      MD2     STX M1+2
1976  2B8D- 86 02              STX M1+1
1977  2B8F- 86 01              STX M1
1978  2B91- B0 0D              BCS OVCHK
1979  2B93- 30 04              BMI MD3
1980  2B95- 68                 PLA
1981  2B96- 68                 PLA
1982  2B97- 90 B2              BCC NORMX
1983  2B99- 49 80      MD3     EOR =$80
1984  2B9B- 85 00              STA X1
1985  2B9D- A0 17              LDY =$17

----------------------------------------------------------------------

R65 PASCAL: FLP-MATH               24/02/19   R65 ASSEMBLER  PAGE 42

1986  2B9F- 60                 RTS
1987  2BA0- 10 F7      OVCHK   BPL MD3
1988  2BA2- 4C A6 21   OVFL    JMP DIV1-5      PASCAL RUNTIME ERROR
1989                   *
1990                   * FIX: FIX F1 IN M1, M1+1
1991                   *************************
1992                   *
1993  2BA5- 20 1D 2B           JSR RTAR
1994  2BA8- A5 00      FIX     LDA X1
1995  2BAA- C9 8E              CMP =$8E
1996  2BAC- D0 F7              BNE FIX-3
1997  2BAE- 60         RTRN    RTS
1998                   *
1999                           TIT R65 PASCAL: RANDOM ACCESS
2000                           PAG

----------------------------------------------------------------------

R65 PASCAL: RANDOM ACCESS          24/02/19   R65 ASSEMBLER  PAGE 43

2001                   *
2002                   * RANDOM ACCESS FILE HANDLER
2003                   ****************************
2004                   *
2005                   *
2006                   * OPENRA: OPEN A FILE FOR RANDOM ACCESS
2007                   ***************************************
2008                   *
2009                   * ENTRY: FILNM1,FILCY1,FILDRV,FILFLG
2010                   * FILFLG: BIT 7: PROTECTED (NEW ONLY)*
2011                   *         BIT 6: NO PRINTED OUTPUT
2012                   *         BIT 5: DIRECTION (0=READ)
2013                   *         BIT 4: 1=NEW, 0=OLD
2014                   *
2015                   * NEW ONLY: MAXSIZ,FILSA
2016                   *
2017                   * EXIT: NO OF OPEN FILE IN Y, STATUS IN A
2018                   *       AND FILERR, Y IS ONLY VALID
2019                   *       IF A=0
2020                   *
2021                   *
2022  2BAF- AC 36 03   OPENRA  LDY MAXSEQ      SEARCH EMPTY ENTRY
2023  2BB2- B9 39 03           LDA FIDRTB,Y    BIT 5=1: ENTRY USED
2024  2BB5- 29 20              AND =$20
2025  2BB7- F0 08              BEQ OPENRA1     FOUND, SKIP
2026  2BB9- 88                 DEY
2027  2BBA- 10 F6              BPL OPENRA+3
2028                   *
2029  2BBC- A9 23              LDA =$23        TOO MANY OPEN FILES
2030  2BBE- 85 DB              STA FILERR
2031  2BC0- 60                 RTS
2032                   *
2033  2BC1- 8C 35 03   OPENRA1 STY CURSEQ      SAVE CURRENT ENTRY NO
2034  2BC4- A5 DC              LDA FILDRV      GET AND TEST DRIVE
2035  2BC6- 99 41 03           STA FIDVTB,Y
2036  2BC9- 29 FE              AND =$FE
2037  2BCB- F0 05              BEQ OPENRA2     SKIP, IF OK
2038                   *
2039  2BCD- A9 28              LDA =$28        ILLEGAL DRIVE FOR RA
2040  2BCF- 85 DB              STA FILERR
2041  2BD1- 60                 RTS
2042                   *
2043  2BD2- A9 10      OPENRA2 LDA =$10        TEST OLD/NEW FLAG
2044  2BD4- 25 DA              AND FILFLG
2045  2BD6- F0 78              BEQ OPENOLD     SKIP, IF OLF
2046                   *
2047                   * OPEN A NEW FILE
2048                   *
2049  2BD8- A5 DA      OPENNEW LDA FILFLG
2050  2BDA- 29 80              AND =$80        GET PROTECTED FLAG

----------------------------------------------------------------------

R65 PASCAL: RANDOM ACCESS          24/02/19   R65 ASSEMBLER  PAGE 44

2051  2BDC- 09 42              ORA ='B'        BLOCK FILE
2052  2BDE- 8D 00 03           STA FILTYP      SET FILE TYPE
2053                   *
2054  2BE1- A9 00              LDA =0
2055  2BE3- AD 37 03           LDA MAXSIZ      SIZE OF FILE
2056  2BE6- 8D 15 03           STA FILSIZ
2057  2BE9- 8E 16 03           STX FILSIZ+1
2058                   *
2059  2BEC- CA                 DEX             COMPUTE FILEA
2060  2BED- AD 1A 03           LDA FILSA
2061  2BF0- 18                 CLC
2062  2BF1- 69 FF              ADC =$FF
2063  2BF3- 8D 1C 03           STA FILEA
2064  2BF6- 8A                 TXA
2065  2BF7- 6D 1B 03           ADC FILSA+1
2066  2BFA- 8D 1D 03           STA FILEA+1
2067                   *
2068  2BFD- 20 1E E8          JSR SETFID      SET FILEDATE
2069                   *
2070  2C00- A2 10              LDX =16
2071  2C02- BD 20 03   OPENNE1 LDA FILNM1,X    SET FILNM1 AND FILCY1
2072  2C05- 9D 01 03           STA FILNAM,X    TO FILNAM AND FILCYC
2073  2C08- CA                 DEX
2074  2C09- 10 F7              BPL OPENNE1
2075                   *
2076                   * SEARCH IN DIRECTORY AND RETURN CYCLUS
2077                   * AND DIRECTORY ENTRY TO USE, TEST EXISTING
2078                   * FILES FOR SAME NAME AND CYCLUS, DISK
2079                   * OPERATION IS INITIALIZED
2080                   *
2081  2C0B- 20 94 20           JSR PREPWRA
2082  2C0E- 8E 11 03           STX FILCYC
2083                   *
2084                   * FIND FIRST EMPTY DISK DIRECTORY ENTR
2085                   * FETCH ITAND SET FIRST SECTOR OF FILE TO
2086                   * FILLOC, OUTPUT Y,X AS NUMBER OF EMPTY
2087                   * SECTORS
2088                   *
2089  2C11- 20 97 20           JSR PREPWRB
2090  2C14- 8A                 TXA
2091  2C15- CD 16 03           CMP FILSIZ+1
2092  2C18- 98                 TYA
2093  2C19- E9 00              SBC =0          COMPARE WITH REQUESTED
2094  2C1B- B0 05              BCS OPENNE3     SECTORS
2095                   *
2096  2C1D- A9 26              LDA =$26        DISK OVERFLOW
2097  2C1F- 4C 8B 20           JMP DISCER1
2098                   *
2099                   * SET FITEMP,Y AND FITEMP+8,YNTO FIRST SECTOT
2100                   * OF FILE ON DISK, FIMAXT,Y TO SIZE, DIRECTORY

----------------------------------------------------------------------

R65 PASCAL: RANDOM ACCESS          24/02/19   R65 ASSEMBLER  PAGE 45

2101                   * ENTRY NO TO FITEMP+16,Y
2102                   * THEN PUT THIS ENTRY ONTO THE DISKMAND SET
2103                   * A NEW END OF DIRECTORY MARK
2104                   *
2105  2C22- 20 70 20   OPENNE3 JSR DOPEN4
2106                   *
2107  2C25- AC 35 03           LDY CURSEQ      SETUP DUMMY FIRST SECTOR
2108  2C28- A9 00              LDA =0
2109  2C2A- 99 49 03           STA FIBPTB,Y
2110  2C2D- 99 51 03           STA FIRCTB,Y
2111                   *
2112  2C30- AC 35 03   OPENNE4 LDY CURSEQ      OPEN FILE
2113  2C33- A5 DA              LDA FILFLG
2114  2C35- 0A                 ASL A
2115  2C36- 0A                 ASL A
2116  2C37- 29 80              AND =$80        GET DIRECTION
2117  2C39- 48                 PHA
2118  2C3A- 2D 00 03           AND FILTYP
2119  2C3D- F0 06              BEQ OPENNE5     OK, SKIP
2120  2C3F- 68                 PLA             PROTECTED FILE
2121                   *
2122  2C40- A9 29              LDA =$29
2123  2C42- 85 DB              STA FILERR
2124  2C44- 60                 RTS
2125                   *
2126  2C45- 68         OPENNE5 PLA
2127  2C46- 09 60              ORA =$60        RA FILE, OPENIT
2128  2C48- 99 39 03           STA FIDRTB,Y
2129                   *
2130  2C4B- A9 00              LDA =0          NORMALEXIT
2131  2C4D- 85 DB              STA FILERR
2132  2C4F- 60         OPENNE6 RTS
2133                   *
2134                   * OPEN AN OLD FILE:
2135                   * PREPARE DISK OPERATION, SEARCH REQUESTED
2136                   * FILE AND GET CORRSPONDING DISK ENTRY
2137                   *
2138  2C50- 20 91 20   OPENOLD JSR PREPRD
2139                   *
2140  2C53- 20 73 20           JSR PRFLB1      PRINT LABEL, IF REQ.
2141  2C56- AD 00 03           LDA FILTYP
2142  2C59- 29 7F              AND =$7F
2143  2C5B- C9 42              CMP ='B'        MUST BE BLOCK FILE
2144  2C5D- F0 05              BEQ OPENOL1     SKIP, IF OK
2145                   *
2146  2C5F- A9 05              LDA =5
2147  2C61- 4C 8B 20           JMP DISCER1     FILE TYPE ERROR
2148                   *
2149  2C64- 20 8E 20   OPENOL1 JSR ENDDO       END OF DISK OPERATION
2150                   *

----------------------------------------------------------------------

R65 PASCAL: RANDOM ACCESS          24/02/19   R65 ASSEMBLER  PAGE 46

2151                   * SET NOW FIRST SECTOR AND SIZE TO TABLE
2152                   *
2153  2C67- 20 6D 20           JSR DOPEN1
2154                   *
2155  2C6A- A9 00              LDA =0          GET FIRST RECORD
2156  2C6C- 20 73 2C           JSR GETTREC
2157  2C6F- D0 DE              BNE OPENNE6     SKIP, IF NOT OK
2158  2C71- F0 BD              BEQ OPENNE4     ELSE OPEN FILE
2159                   *
2160                   *
2161                   * GETTREC: GET ONE RECORD FROM RA-FILE
2162                   * RECORD NUMBER IS IN A, FILE NUMBER IN CURSEQ
2163                   * RESULT IUS Z=1,OF OK, ELSE Z=0 AND FILERR
2164                   *
2165  2C73- AE 35 03   GETTREC LDX CURSEQ      SAVE RECORD NO
2166  2C76- 9D 51 03           STA FIRCTB,X
2167  2C79- A9 00              LDA =0          CLEAR UPDATED FLAG
2168  2C7B- 9D 49 03           STA FIBPTB,X
2169  2C7E- BD 41 03           LDA FIDVTB,X    SET DRIVE NO
2170  2C81- 85 DC              STA FILDRV
2171                   *
2172                   * COMPUTE DATA-POINTER AND BINARY
2173                   * TRACK,SECTOR, SETUP FILDRV
2174                   *
2175  2C83- 20 79 20           JSR PREPSR
2176                   *
2177                   * ADD RECORD NUMBER TO BINARY TRAC/SECTOR
2178                   * TEST SIZE OF FILE, CONVERT TO TRACK AND
2179                   * SECTOR, INITIALIZE DISK OPERATION
2180                   *
2181  2C86- 20 7C 20           JSR PREPSR1
2182                   *
2183  2C89- 20 82 20           JSR READ        READ ON SECTOR
2184                   *
2185  2C8C- 4C 8E 20           JMP ENDDO       END OF DISK OPERATION
2186                   *
2187                   * PUTTREC: SAVE CURRENT RECORD ON DISK
2188                   * FILE NUMBER IN CURSEQ, RECORD NUMBER IN
2189                   * FIRCTB,Y, RETURNS Z=1 IF OK, ELSE FILERR
2190                   *
2191  2C8F- BD 41 03   PUTTREC LDA FIDVTB,X
2192  2C92- 85 DC              STA FILDRV
2193  2C94- 20 79 20           JSR PREPSR      SEE GETTREC FOR
2194  2C97- 20 7C 20           JSR PREPSR1     COMMENTS
2195  2C9A- 20 85 20           JSR WRITE
2196  2C9D- 4C 8E 20           JMP ENDDO
2197                   *
2198                   * GETNEWR: GET A NEW RECORD, SAVE OLD, IF
2199                   * OLD HAS BEEN UPDATED
2200                   * ENTRY: NEW RECORD IN A, FILE NO IN CURSEQ

----------------------------------------------------------------------

R65 PASCAL: RANDOM ACCESS          24/02/19   R65 ASSEMBLER  PAGE 47

2201                   * EXIT: z=1 IF OK, ELSE FILERR
2202                   *
2203  2CA0- 8D 34 03   GETNEWR STA SAVRST+1    SAVE REQUESTED RECORD
2204  2CA3- AE 35 03           LDX CURSEQ
2205  2CA6- BD 49 03           LDA FIBPTB,X    UPDATED?
2206  2CA9- 10 05              BPL GETNEW1
2207                   *
2208  2CAB- 20 8F 2C           JSR PUTTREC     YES, SAVE IT
2209  2CAE- D0 23              BNE EXIT
2210                   *
2211  2CB0- AD 34 03   GETNEW1 LDA SAVRST+1    GET REQUESTED RECORD
2212  2CB3- 4C 73 2C           JMP GETTREC
2213                   *
2214                   * GETBYTE: GET ONE BYTE FROM FILE
2215                   *********************************
2216                   * ENTRY: FILE NUMBER IN X
2217                   *        POINTER IN A(LOW) AND Y(HIGH)
2218                   * EXIT:  FILERR IN Y AND STATUS, BYTE IN A
2219                   *
2220  2CB6- 8D 33 03   GETBYTE STA SAVRST      SAVE A
2221  2CB9- 20 03 2D           JSR TESTRA
2222                   *
2223  2CBC- 98                 TYA
2224  2CBD- DD 51 03           CMP FIRCTB,X    IS IT IN CURRENT RECORD?
2225  2CC0- F0 05              BEQ GETBYT1     YES, SKIP
2226                   *
2227  2CC2- 20 A0 2C           JSR GETNEWR     NO, GET NEW RECORD
2228  2CC5- D0 0C              BNE EXIT
2229                   *
2230  2CC7- 20 76 20   GETBYT1 JSR CPOINT      COMPUTE BUFFER PNT
2231  2CCA- AC 33 03           LDY SAVRST      RESTORE LOW POINTER
2232  2CCD- B1 FA              LDA (POINT),Y   GET THE BYTE
2233  2CCF- A0 00              LDY =0
2234  2CD1- 84 DB              STY FILERR      OK
2235  2CD3- 60         EXIT    RTS
2236                   *
2237                   * PUTBYTE: PUT ONE BYTE TO FILE
2238                   *******************************
2239                   *
2240                   * ENTRY: BYTE STORED IN KCHAR
2241                   *        FILE NUMBER IN X
2242                   *        POINTER IN A(LOW) AND Y(HIGH)
2243                   * EXIT:  FILERR IN Y AND STATUS
2244                   *
2245  2CD4- 8D 33 03   PUTBYTE STA SAVRST
2246  2CD7- 20 03 2D           JSR TESTRA
2247  2CDA- BD 39 03           LDA FIDRTB,X    IS WRITE ALLOWED?
2248  2CDD- 10 05              BPL PUTBYT0     YES,SKIP
2249  2CDF- A0 29              LDY =$29        WRITE NOT ALLOWED
2250  2CE1- 84 DB              STY FILERR

----------------------------------------------------------------------

R65 PASCAL: RANDOM ACCESS          24/02/19   R65 ASSEMBLER  PAGE 48

2251  2CE3- 60                 RTS
2252                   *
2253  2CE4- 98         PUTBYT0 TYA             FOR COMMENTS
2254  2CE5- DD 51 03           CMP FIRCTB,X    SEE GETBYTE
2255  2CE8- F0 05              BEQ PUTBYT1
2256                   *
2257  2CEA- 20 A0 2C           JSR GETNEWR
2258  2CED- D0 E4              BNE EXIT
2259                   *
2260  2CEF- 20 76 20   PUTBYT1 JSR CPOINT
2261  2CF2- A9 80              LDA =$80        SET UPDATED FLAG
2262  2CF4- 9D 49 03           STA FIBPTB,X
2263  2CF7- AC 33 03           LDY SAVRST
2264  2CFA- A5 FE              LDA KCHAR       GET BACK KCHAR
2265  2CFC- 91 FA              STA (POINT),Y
2266  2CFE- A0 00             LDY =0
2267  2D00- 84 DB              STY FILERR
2268  2D02- 60                 RTS
2269                   *
2270                   *
2271                   * TESTRA: TEST X FOR LEGAL RA-FILE
2272                   *
2273  2D03- 8E 35 03   TESTRA  STX CURSEQ
2274  2D06- EC 36 03           CPX MAXSEQ
2275  2D09- B0 0A              BCS TESTRA2
2276                   *
2277  2D0B- BD 39 03   TESTRA1 LDA FIDRTB,X
2278  2D0E- 29 60              AND =$60
2279  2D10- C9 60              CMP =$60
2280  2D12- D0 03              BNE TESTRA3     SKIP, IF NOT OK
2281  2D14- 60                 RTS
2282                   *
2283  2D15- F0 F4      TESTRA2 BEQ TESTRA1
2284  2D17- 68         TESTRA3 PLA
2285  2D18- 68                 PLA
2286  2D19- A0 25              LDY =$25        FILE NUMBER NOT ALLOWED
2287  2D1B- 84 DB              STY FILERR
2288  2D1D- 60                 RTS
2289                   *
2290                   * CLOSRA: CLOSE RA OR SEQUENTIAL FILE IN X
2291                   ******************************************
2292                   * ENTRY: FILE IN X
2293                   * EXIT: FILERR IN Y AND STATUS
2294                   *
2295  2D1E- BD 39 03   CLOSRA  LDA FIDRTB,X
2296  2D21- 29 40              AND =$40        SEQUENTIAL FILE?
2297  2D23- D0 03              BNE CLOSRA1     NO, SKIP
2298  2D25- 4C 7F 20           JMP CLOSE       YES, CLOSE IT
2299                   *
2300  2D28- 20 03 2D   CLOSRA1 JSR TESTRA      MUST BE RA-FILE

----------------------------------------------------------------------

R65 PASCAL: RANDOM ACCESS          24/02/19   R65 ASSEMBLER  PAGE 49

2301  2D2B- BD 49 03           LDA FIBPTB,X    UPDATED?
2302  2D2E- F0 05              BEQ CLOSRA2     NO, SKIP
2303                   *
2304  2D30- 20 8F 2C           JSR PUTTREC
2305  2D33- D0 0B              BNE CLOSRA3
2306                   *
2307  2D35- AE 35 03   CLOSRA2 LDX CURSEQ
2308  2D38- A9 00              LDA =0
2309  2D3A- 9D 39 03           STA FIDRTB,X    CLOSE IT
2310  2D3D- A8                 TAY
2311  2D3E- 84 DB              STY FILERR
2312  2D40- 60         CLOSRA3 RTS
2313                   *
2314                   ENDCODE EQU *
2315                   *
2316                           TIT R65 PASCAL: LABELS
2317                   *
2318  2D41-                    END
LABELS=014E
ERRORS=00
RECORDS=72
